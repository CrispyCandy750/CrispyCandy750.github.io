<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>酥心糖的博客</title>
  
  <subtitle>酥心糖的博客</subtitle>
  <link href="http://crispycandy.top/atom.xml" rel="self"/>
  
  <link href="http://crispycandy.top/"/>
  <updated>2023-01-11T13:50:43.674Z</updated>
  <id>http://crispycandy.top/</id>
  
  <author>
    <name>Crispy Candy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MySql笔记</title>
    <link href="http://crispycandy.top/bi-ji/mysqlbi-ji/"/>
    <id>http://crispycandy.top/bi-ji/mysqlbi-ji/</id>
    <published>2023-01-11T13:42:06.000Z</published>
    <updated>2023-01-11T13:50:43.674Z</updated>
    
    <content type="html"><![CDATA[<p>学习时间：2022.09.05—2022.09.09</p><h1 id="一、环境配置"><a href="#一、环境配置" class="headerlink" title="一、环境配置"></a>一、环境配置</h1><h2 id="NO-1-安装配置MySQL"><a href="#NO-1-安装配置MySQL" class="headerlink" title="NO.1 安装配置MySQL"></a>NO.1 安装配置MySQL</h2><p>5.7是使用最多的，比较稳定，所以用这个来学<br>Mysql5.7地址: <a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.19-winx64.zip">https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.19-winx64.zip</a></p><p>如果安装过Mysql过程中，出错了或者想重新再来一把<br>sc delete mysql【删阶已经安装好的 mysql服务∶老师提示:慎重，一定要确定好不需要这个服务了，否则就完蛋了】</p><ol><li>download zip file</li><li>the path of unpacking avoids Chinese characters and space，我这里是E:\MySQL\mysql-5.7.19-winx64</li><li>add environment variables to run mysql in any dos directory<br>添加环境变量:电脑-属性-高级系统设置-环境变量，在Path环境变量增加 mysql的安装目录\bin目录</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905200812705.png" alt="image-20220905200812705"></p><ol start="4"><li><p>在 D:\hspmysqlmysql-5.7.19-winx64目录下下创建my.ini 文件，需要我们自己创建</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">client</span><span class="token punctuation">]</span></span><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">3306</span>  <span class="token comment"># 客户端的端口是3306</span><span class="token key attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span><span class="token comment"># 设置为自己MYSQL的安装目录，不对的要改</span><span class="token key attr-name">basedir</span><span class="token punctuation">=</span><span class="token value attr-value">E:\MySQL\mysql-5.7.19-winx64\</span><span class="token comment"># 设置为MYSQL的数据目录,这个是系统帮我们创建的，自己不要创建</span><span class="token key attr-name">datadir</span><span class="token punctuation">=</span><span class="token value attr-value">D:\hspmysql\mysql-5.7.19-winx64\data\</span><span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">3306</span><span class="token key attr-name">character_set_server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span><span class="token comment">#跳过安全检查，不用密码也能使用</span>skip-grant-tables<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>使用==管理员身份==打开cmd，并切换到E:\MySQL\mysql-5.7.19-winx64\bin目录下，执行mysqld -install<br>我的话是这个.\mysqld -install</p></li><li><p>初始化数据库: mysqld –initialize-insecure –user=mysql，同样的，我也加了.\</p></li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905201836733.png" alt="image-20220905201836733"></p><p>出现了data文件夹,里面是这样的</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905201926879.png" alt="image-20220905201926879"></p><ol start="7"><li><p>启动mysql 服务: net start mysql【停止 mysql服务指令net stop mysql】，如果成功:</p><pre class="line-numbers language-none"><code class="language-none">PS E:\MySQL\mysql-5.7.19-winx64\bin&gt; net start mysqlMySQL 服务正在启动 .MySQL 服务已经启动成功。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905202221951.png" alt="image-20220905202221951"></p></li><li><p>进入mysql管理终端: mysql -u root -p【当前root用户密码为空】,-u root表示root用户，-p是密码</p><pre class="line-numbers language-none"><code class="language-none">PS E:\MySQL\mysql-5.7.19-winx64\bin&gt; .\mysql -u root -pEnter password:  //第一次没有密码，直接回车 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>修改root 用户密码</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">use mysql<span class="token punctuation">;</span>update user <span class="token builtin class-name">set</span> <span class="token assign-left variable">authentication_string</span><span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'193848'</span><span class="token punctuation">)</span> where <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">'root'</span> and <span class="token assign-left variable">Host</span><span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">;</span>注意:在后面需要带分号，回车即可执行该指令第二句指令表示修改密码为123 用户为root 登录的地方是本地执行:  flush privileges<span class="token punctuation">;</span>   刷新权限退出：quit  // 仅仅是退出中断，但是MySQL仍然在运行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql<span class="token operator">&gt;</span> use mysql<span class="token punctuation">;</span>Database changedmysql<span class="token operator">&gt;</span> update user <span class="token builtin class-name">set</span> <span class="token assign-left variable">authentication_string</span><span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'就是你的密码'</span><span class="token punctuation">)</span> where <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">'root'</span> and <span class="token assign-left variable">Host</span><span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">;</span>Query OK, <span class="token number">1</span> row affected, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>Rows matched: <span class="token number">1</span>  Changed: <span class="token number">1</span>  Warnings: <span class="token number">1</span>mysql<span class="token operator">&gt;</span> flush privileges<span class="token punctuation">;</span>Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">&gt;</span> quitBye<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>修改my.ini 注销跳过验证的语句</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token comment">#skip-grant-tables</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>重新开始后就需要验证了</p><pre class="line-numbers language-none"><code class="language-none">net start mysql //运行MySQLmysql -u root -pEnter password: 输入密码才能登入<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>如果安装错了，就是上面的sc delete mysql，安装错了才能这样</p></li></ol><h2 id="NO-2-连接数据库"><a href="#NO-2-连接数据库" class="headerlink" title="NO.2 连接数据库"></a>NO.2 连接数据库</h2><h3 id="1-命令行连接数据库"><a href="#1-命令行连接数据库" class="headerlink" title="1. 命令行连接数据库"></a>1. 命令行连接数据库</h3><p>只要是一个服务，就会有监听端口，这个端口在my.ini里面，端口是3306</p><pre class="line-numbers language-none"><code class="language-none">连接到Mysql服务(Mysql数据库)的指令mysql -h 主机IP -P 端口 -u 用户名 –p密码注意：(1)-p密码不要有空格(2)-p后面没有写密码，回车会要求输入密码(3) 连接之前MySQL一定要是运行的状态 net start mysql(4) 本机连接的话 ip地址就是localhost，不写的话默认就是本机(5) -P 后面不写的话默认是3306 这就是数据库的默认的，实际工作中一般都会修改，在my.ini中，因为这个太明显了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">PS E:\MySQL\mysql-5.7.19-winx64\bin&gt; .\mysql -h localhost -P 3306 -u root -p193848<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我是这样进来的，就直接进入了，注意，仍然是要在bin目录下才能进入，而且我必须得输入localhost才能进入，默认不输就进不去，输入本机的IP也不行，只能输入localhost才能进来</p><h3 id="2-Navicat连接数据库"><a href="#2-Navicat连接数据库" class="headerlink" title="2. Navicat连接数据库"></a>2. Navicat连接数据库</h3><p>自己在b站上找破解版的</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905212011818.png" alt="image-20220905212011818"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905212043911.png" alt="image-20220905212043911"></p><p>右键点击本地MySQL，建立连接，新建数据库</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905212147532.png" alt="image-20220905212147532"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905212221435.png" alt="image-20220905212221435"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905212325620.png" alt="image-20220905212325620"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905212357256.png" alt="image-20220905212357256"></p><p>保存，输入表的名字，我是users，点开后就是表</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905212433525.png" alt="image-20220905212433525"></p><p>==tab键是添加一行==</p><h4 id="Navicat使用MySQL命令"><a href="#Navicat使用MySQL命令" class="headerlink" title="Navicat使用MySQL命令"></a>Navicat使用MySQL命令</h4><p>可视化界面还是给非程序员使用的，在java中控制MySQL还是要用指令的</p><p>使用这个可视化界面也是可以用命令行的</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906112458824.png" alt="image-20220906112458824"></p><p>==因为命令行不比代码。不是所有的都要执行的，只是执行一句话，而且选中执行的话可以多次执行一句话，就很方便==</p><h1 id="二、数据库介绍"><a href="#二、数据库介绍" class="headerlink" title="二、数据库介绍"></a>二、数据库介绍</h1><h2 id="NO-1-数据库三层结构"><a href="#NO-1-数据库三层结构" class="headerlink" title="NO.1 数据库三层结构"></a>NO.1 数据库三层结构</h2><ol><li>所谓安装Mysql数据库，就是在主机安装一个数据库管理系统(DBMS)，这个管理程序可以管理多个数据库。DBMS(database manage system)</li><li>一个数据库中可以创建多个表,以保存数据(信息)。</li><li>数据库管理系统(DBMS)、数据库和表的关系如图所示:示意图</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905213425940.png" alt="image-20220905213425940"></p><p>MySQL contains three layer structure : DBMS DB table(DB contains other elements , the table is commonly used )</p><pre class="line-numbers language-none"><code class="language-none">TCP    0.0.0.0:3306           0.0.0.0:0              LISTENING[mysqld.exe]  // mysqld listen on the port 3306，我们所有的command都是发送到这个程序了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905214035078.png" alt="image-20220905214035078"></p><ol><li>==the database we create is stored in the data file==</li><li>table is stored in the database file </li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905214254337.png" alt="image-20220905214254337"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905214313923.png" alt="image-20220905214313923"></p><p>我们在DOS 或者 java里面的指令都是发送到那个port，然后DBMS进行执行的</p><p>==the essence of database is file, which is also called disk, but not memory==</p><p> <img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220905214445835.png" alt="image-20220905214445835"></p><h2 id="NO-2-数据的存储形式"><a href="#NO-2-数据的存储形式" class="headerlink" title="NO.2 数据的存储形式"></a>NO.2 数据的存储形式</h2><p>数据在数据库中的存储方式，row column，也就是以一列的形式存储</p><h2 id="NO-3-SQL语言分类"><a href="#NO-3-SQL语言分类" class="headerlink" title="NO.3 SQL语言分类"></a>NO.3 SQL语言分类</h2><ol><li>DDL:数据定义语句[create表，库…]</li><li>DML:数据操作语句[增加insert,修改update,删除delete]</li><li>DQL:数据查询语句[select ]</li><li>DCL:数据控制语句[管理数据库:比如用户权限grant revoke ]</li></ol><h1 id="三、数据库操作"><a href="#三、数据库操作" class="headerlink" title="三、数据库操作"></a>三、数据库操作</h1><h2 id="NO-1-创建数据库"><a href="#NO-1-创建数据库" class="headerlink" title="NO.1 创建数据库"></a>NO.1 创建数据库</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE DATABASE [IF NOT EXISTS] db_name [create_specification [, create_specification] ...]create_specification:[DEFAULTJCHARACTER SET charset_name[DEFAULTjCOLLATE collation_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol><li>CHARACTER SET:指定数据库采用的字符集，如果不指定字符集，默认utf8</li><li>COLLATE:指定数据库字符集的校对规则(<strong>常用的utf8_bin</strong>[区分大小引]<strong>utf8_general_ci[<strong>不区分大小写]注意</strong>默认是</strong>utf8_general_ci)</li><li>IF NOT EXISTS：如果不写，在创建过程中发现已经有这个数据库，就会报错</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE DATABASE db01;  # 最简单的创建db01数据库，默认设置utf8 和 utf_general_ci# 分号可写可不写的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="大小写校验规则"><a href="#大小写校验规则" class="headerlink" title="大小写校验规则"></a>大小写校验规则</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE DATABASE db01 CHARACTER SET utf8CREATE DATABASE db02 CHARACTER set utf8 COLLATE utf8_bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>according to the command above ,db01 use utf8_general_ci and db02 use utf8_bin to collate</p><p>Create the same table in two DBs</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906114241301.png" alt="image-20220906114241301"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> t1 <span class="token class-name">WHERE</span> name <span class="token operator">=</span> <span class="token string">"tom"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th>conclusion of db01   (utf8_general_ci)</th><th>conclusion of db02   (utf8_bin)</th></tr></thead><tbody><tr><td><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111113038563.png" alt="image-20230111113038563"></td><td><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111113047957.png" alt="image-20230111113047957"></td></tr></tbody></table><h3 id="避免关键词"><a href="#避免关键词" class="headerlink" title="``避免关键词"></a>``避免关键词</h3><p>when creating database , using `` can avoid key words</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># create is key word, cannot be database name by default, the command fails to executeCREATE DATABASE CREATE# add `` can avoid the key word, a database named CREATE is created successfullyCREATE DATABASE `CREATE`<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-2-查看-删除数据库结构"><a href="#NO-2-查看-删除数据库结构" class="headerlink" title="NO.2 查看\删除数据库结构"></a>NO.2 查看\删除数据库结构</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示数据库语句: 这个是查看所有的数据库，后面有个SSHOW DATABASES# 显示数据库创建语句:SHOW CREATE DATABASE db_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># db_ name数据库删除语句[一定要慎用]:DROP DATABASE [IF EXISTS] db_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="NO-3-备份恢复数据库"><a href="#NO-3-备份恢复数据库" class="headerlink" title="NO.3 备份恢复数据库"></a>NO.3 备份恢复数据库</h2><ol><li>transfer the database to the client , the database are required to backup </li><li>database needs to be backuped regularly to avoid losing or be attacked by hacker </li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 备份数据库(注意:在DOS执行)命令行，当然Navicat也可以在图形界面点击导出备份和导入，但是不能再Navicat的查询界面输入，这个不需要进入mysql，直接输入即可mysqldump -u 用户名 -p -B 数据库1 数据库2 数据库n... &gt;文件名.sql# (文件名可以包含路径)# 恢复数据库(注意:进入Mysql命令行再执行)Source文件名.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906143648909.png" alt="image-20220906143648909"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysqldump -u root -p -B db01 db02 &gt; d:\\backup.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">Enter password: ******<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906144049638.png" alt="image-20220906144049638"></p><p>==sql里面存储着创建备份表所需要的所有dos指令==</p><h2 id="NO-4-备份恢复数据库的表"><a href="#NO-4-备份恢复数据库的表" class="headerlink" title="NO.4 备份恢复数据库的表"></a>NO.4 备份恢复数据库的表</h2><h3 id="1-备份表"><a href="#1-备份表" class="headerlink" title="1. 备份表"></a>1. 备份表</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">mysqldump <span class="token operator">-</span>u 用户名 <span class="token operator">-</span>p密码 数据库 表<span class="token number">1</span> 表<span class="token number">2</span> 表n <span class="token operator">&gt;</span> d<span class="token operator">:</span>\\文件名<span class="token punctuation">.</span>sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysqldump -u root -p db01 t1 &gt; d:\\backtable.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>==一定要在cmd中备份而不是powershell里面==，不能再mysql程序中。</p><p>这样数据就存在了sql文件中了，因此sql文件就是一个数据表的备份</p><h3 id="2-恢复表"><a href="#2-恢复表" class="headerlink" title="2. 恢复表"></a>2. 恢复表</h3><h4 id="1-复制执行"><a href="#1-复制执行" class="headerlink" title="(1) 复制执行"></a>(1) 复制执行</h4><p>就是直接将sql里面的指令全部复制运行一遍</p><p>==将sql文件里面的指令全部运行，就得到原来的了==，但是如果数据很大的话就不好</p><h4 id="2-source指令导入"><a href="#2-source指令导入" class="headerlink" title="(2) source指令导入"></a>(2) source指令导入</h4><p>就是将sql文件直接导入数据库</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">source d:\\backtable.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意不用在意数据库，这个文件直接将表导入到对应的数据库中</p><h1 id="四、数据类型-列类型"><a href="#四、数据类型-列类型" class="headerlink" title="四、数据类型(列类型)"></a>四、数据类型(列类型)</h1><ol><li>data byte is also called ==column type==</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906154043986.png" alt="image-20220906154043986"></p><h2 id="NO-1-整数类型"><a href="#NO-1-整数类型" class="headerlink" title="NO.1 整数类型"></a>NO.1 整数类型</h2><ol><li>能够满足需求的情况下，尽量选择小的数据类型<br>不知道多大就int</li></ol><table><thead><tr><th>type</th><th>word</th><th>minimum</th><th>maximum</th></tr></thead><tbody><tr><td></td><td></td><td>（signed/ unsigned）</td><td>（signed/ unsigned）</td></tr><tr><td>TINYINT</td><td>1</td><td>-128</td><td>127</td></tr><tr><td>TINYINT UNSIGNED</td><td></td><td>0</td><td>255</td></tr><tr><td>SMALLINT</td><td>2</td><td>-32768</td><td>32767</td></tr><tr><td>SMALLINT UNSIGNED</td><td></td><td>0</td><td>65535</td></tr><tr><td>MEDIUMINT</td><td>3</td><td>-8388608</td><td>8388607</td></tr><tr><td>MEDIUMINT UNSIGNED</td><td></td><td>0</td><td>16777215</td></tr><tr><td>INT</td><td>4</td><td>-2147483648</td><td>2147483647</td></tr><tr><td>INT UNSIGNED</td><td></td><td>0</td><td>4294967295</td></tr><tr><td>BIGINT</td><td>8</td><td>-9223372036854775808</td><td>9223372036854775807</td></tr><tr><td>BIGINT UNSIGNED</td><td></td><td>0</td><td>18446744073709551615</td></tr></tbody></table><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906162110259.png" alt="image-20220906162110259"></p><h3 id="无符号整数"><a href="#无符号整数" class="headerlink" title="无符号整数"></a>无符号整数</h3><p>在Navicat里面创建表的时候可以选中无符号</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t3(id TINYINT;)# ERRORS belowINSERT t3 VALUES(-129);INSERT t3 VALUES(-128);SELECT * FROM t3CREATE TABLE t4(id TINYINT UNSIGNED)# ERRORINSERT t4 VALUES(-1)INSERT t4 VALUES(255)SELECT * FROM t4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-2-位类型"><a href="#NO-2-位类型" class="headerlink" title="NO.2 位类型"></a>NO.2 位类型</h2><ol><li>bit字段显示时，按照位的方式显示.</li><li>查询的时候仍然可以用使用添加的数值</li><li>==如果一个值只有0,1可以考虑使用bit(1),可以节约空间位类型。==</li><li>M指定位数,默认值1,范围1-64,使用不多.</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 8位存储，equals to tinyint#显示的时候按照bit的形式显示CREATE TABLE t5(num BIT(8))INSERT INTO t5 VALUES(3);INSERT INTO t5 VALUES(255);SELECT * FROM t5;# 查询时，按照值来查询SELECT * FROM t5 WHERE num = 3;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-3-浮点数类型"><a href="#NO-3-浮点数类型" class="headerlink" title="NO.3 浮点数类型"></a>NO.3 浮点数类型</h2><ol><li>FLOAT/DOUBLE [UNSIGNED]<br>Float单精度精度,Double双精度</li></ol><h4 id="DECIMAL-M-D-类型"><a href="#DECIMAL-M-D-类型" class="headerlink" title="DECIMAL(M,D)类型"></a>DECIMAL(M,D)类型</h4><ol><li>DECIMAL(M,D) [UNSIGNED]<ol><li>可以支持更加精确的小数位。M是小数位数(精度)的总数,D是小数点(标度)后面的位数。</li><li>==如果D是0，则值没有小数点或分数部分。==</li><li>==M最大65。D最大是30。==</li><li>==如果D被省略,默认是0。如果M被省略,默认是10。==</li><li>建议:如果希望小数的精度高,推荐使用decimal</li><li>如果没有明确的要求，就用double</li></ol></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t6 (num1 FLOAT,num2 DOUBLE,num3 DECIMAL(30, 20))INSERT INTO t6 VALUES(88.12345678912345, 88.12345678912345, 88.12345678912345)SELECT * FROM t6;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906164016444.png" alt="image-20220906164016444"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t7(num DECIMAL(65));INSERT INTO t7 # success belowVALUES(132189371938719371983272837213981739183722189371293173917398)SELECT * FROM t7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-4-字符串类型"><a href="#NO-4-字符串类型" class="headerlink" title="NO.4 字符串类型"></a>NO.4 字符串类型</h2><ol><li>CHAR(size)<br>固定长度字符串最大255==字符==，就是字符</li><li>VARCHAR(size) size = 0~21844<br>可变长度字符串最大65532==字节==【utf8编码最大21844字符1-3个字节用于记录大小】</li><li>varchar是按照字节保存的，首先要去掉3个末尾的字节用于保存字段长度<br>==然而不同的编码方式中，一个字符用多少个字节表示就不确定==<br>在utf8中，一个字符3个字节，最大是65532 / 3 = 21844<br>在gbk中，就是2个,size最大是 ==32766==，但是创建表的时候制定==character set gbk==</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t8(# error name char(256)name char(255));create table t9(name VARCHAR(21844));create table t10(name VARCHAR(32766)) CHARACTER SET gbk;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="参数大小"><a href="#参数大小" class="headerlink" title="参数大小"></a>参数大小</h3><ul><li>char(4)  这个4表示字符数(最大255)，不是字节数,==不管是中文还是字母都是放四个==,按字符计算.</li><li>varchar(4)  这个4表示字符数，不管是字母还是中文都以定义好的表的编码来存放数据，==所以具体的字节数是不确定的==</li><li>不管是中文还是英文字母，都是最多存放4个，是按照字符来存放的.</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t11(name char(4));-- INSERT INTO t11 VALUES('abcde');  errorINSERT INTO t11 VALUES('abcd');INSERT INTO t11 VALUES('生日快乐');-- INSERT INTO t11 VALUES('生日快乐a'); errorSELECT * FROM t11;CREATE TABLE t12 (`name` VARCHAR(4));INSERT INTO t12 VALUES('生日快乐');SELECT * FROM t12;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="char和varchar的区别"><a href="#char和varchar的区别" class="headerlink" title="char和varchar的区别"></a>char和varchar的区别</h3><ol><li>char(4)是定长(固定的大小)，就是说，即使你插入’aa’，也会占用分配的4个字符的空间.,后面的空间用默认值来填充，results to the waste of room ,</li><li>varchar(4)是变长，就是说，如果你插入了’aa’,实际占用空间大小并不是4个字符，而是按照实际占用空间来分配 (varchar本身还需要占用1-3个字节来记录存放内容长度)</li><li>varchar的实际长度是 实际的长度 + 1~3个字节</li></ol><h4 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h4><p>什么时候使用char,什么时候使用varchar</p><ol><li>如果数据是定长,推荐使用char，比如md5的密码,邮编，手机号,身份证号码等. char(32</li><li>如果一个字段的长度是不确定,我们使用varchar,比如留言,文章</li><li>speed of quering：char &gt; varchar</li></ol><h3 id="text类型"><a href="#text类型" class="headerlink" title="text类型"></a>text类型</h3><ol><li>在存放文本时，也可以使用Text数据类型.</li><li>可以将TEXT列视为VARCHAR列,注意Text不能有默认值.大小0-2^16^字节</li><li>如果希望存放更多字符(varchar不够用 )，可以选择</li><li><code>MEDIUMTEXT</code> 0-2^24 或者<code>LONGTEXT</code>0~2^32</li><li>在后面也会有字节存储的</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t13(`content1` TEXT,`content2` MEDIUMTEXT,`content3` LONGTEXT);INSERT INTO t13 VALUES('hello', 'hobby', 'like');SELECT * FROM t13;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-5-日期类型"><a href="#NO-5-日期类型" class="headerlink" title="NO.5 日期类型"></a>NO.5 日期类型</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE birthday6(t1 DATE, t2 DATETIME,t3 TIMESTAMP NOT NULL DEFAULTCURRENT_TIMESTAMP ON UPDATECURRENT_TIMESTAMP ) ; timestamp时间戳mysql&gt; INSERT INTO birthday (t1,t2)VALUES( 2022-11-11,2022-11-1110:10:10');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p>添加了NOT——TIMESTAMP这段话之后，当添加记录并且没有设置stamp的值的时候，会默认使用当前的值来填充</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t14 (birthday DATE,job_time DATETIME,login_time TIMESTAMPNOT NULL DEFAULT CURRENT_TIMESTAMPON UPDATE CURRENT_TIMESTAMP);INSERT INTO t14 (birthday, job_time) VALUES ('2022-11-11', '2022-11-11 10:10:10');SELECT * FROM t14;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906174054915.png" alt="image-20220906174054915"></p><p>当更新这条记录的时候，时间也会更新</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>创建一个员工表emp(课堂练习),选用适当的数据类型</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906174823849.png" alt="image-20220906174823849"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE `emp`(id INT,`name` char(10),sex char(1),birthday DATE,entry_date DATETIME,job char(10),salary DOUBLE,resume TEXT)CHARACTER SET utf8 COLLATE utf8_bin ENGINE INNODB;INSERT INTO `emp` VALUES(100, 'jack', '男', '2000-01-01', '2000-1-1 10:10:10', 'student', 1000,'cs major');SELECT * FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="五、表操作"><a href="#五、表操作" class="headerlink" title="五、表操作"></a>五、表操作</h1><h2 id="NO-1-创建表"><a href="#NO-1-创建表" class="headerlink" title="NO.1 创建表"></a>NO.1 创建表</h2><p>这个要在对应数据库下面运行，才会生成到对应的数据库中，注意domain是括号括起来的</p>  <pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE table_name ( field1 datatype,field2 datatype,field3 datatype  # 后面不能有;)character set字符集 collate校对规则 engine引擎<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>field:指定列名</li><li>datatype:指定列类型(字段类型)</li><li>character set : 如不指定则为==所在数据库字符集==，这个是可以指定的</li><li>collate:如不指定则为==所在数据库校对规则==</li><li>engine:存储引擎(这个涉及内容较多，后面单独讲解)</li><li>表的名称中间用_分开</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t1 (id INT,    # `` to avoid key word`name` VARCHAR(255),  `password` VARCHAR(32),`birthday` DATE) CHARACTER SET utf8 COLLATE utf8_bin ENGINE INNODB;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="复制表结构"><a href="#复制表结构" class="headerlink" title="复制表结构"></a>复制表结构</h3><p>表的结构可以直接复制的，但是数据不会复制</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE table2 LIKE table1;# copy the form of table1 to table2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="NO-2-更改表"><a href="#NO-2-更改表" class="headerlink" title="NO.2 更改表"></a>NO.2 更改表</h2><h3 id="1-添加列"><a href="#1-添加列" class="headerlink" title="1. 添加列"></a>1. 添加列</h3><h3 id="2-修改列"><a href="#2-修改列" class="headerlink" title="2. 修改列"></a>2. 修改列</h3><h3 id="3-删除列"><a href="#3-删除列" class="headerlink" title="3. 删除列"></a>3. 删除列</h3><h3 id="4-修改表名"><a href="#4-修改表名" class="headerlink" title="4. 修改表名"></a>4. 修改表名</h3><h3 id="5-修改表字符集"><a href="#5-修改表字符集" class="headerlink" title="5. 修改表字符集"></a>5. 修改表字符集</h3><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906190438598.png" alt="image-20220906190438598"></p><h3 id="exercise"><a href="#exercise" class="headerlink" title="exercise"></a>exercise</h3><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906174823849-167343951809625.png" alt="image-20220906174823849"></p><ol><li>员工表emp的上增加一个image列,varchar类型(要求在resume后面)</li><li>修改job列，使其长度为60。</li><li>删除sex列。</li><li>表名改为employee。</li><li>修改表的字符集为utf8</li><li>列名name修改为user name</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DESC emp #查看表，这个在表操作的时候可以经常调用的<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">#1. add image colume after resume and don't allow NULL, set the default value is ''ALTER TABLE `emp` ADD `image` VARCHAR(32) NOT NULL DEFAULT '' AFTER resume;# 2. modify is modify the type，这是对表的操作，不是对记录的操作，所以不是改值，      没有toALTER TABLE`emp` MODIFY job VARCHAR(60) NOT NULL DEFAULT '';# 3. ALTER TABLE `emp` DROP sex;# 4. only this command contains toRENAME TABLE `emp` to `employee`;# 5. alter TABLE `employee` CHARACTER SET utf8;# 6.ALTER TABLE employee CHANGE `name` user_name VARCHAR(32) NOT NULL DEFAULT '';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>一般字符串后面都设置不要null和default吧</strong></p><h1 id="六、数据操作-CRUD"><a href="#六、数据操作-CRUD" class="headerlink" title="六、数据操作(CRUD)"></a>六、数据操作(CRUD)</h1><h2 id="NO-1-插入数据"><a href="#NO-1-插入数据" class="headerlink" title="NO.1 插入数据"></a>NO.1 插入数据</h2><ol><li>插入的数据应与字段的数据类型相同。比如把’abc’添加到int类型会错误<br>mysql can try to transfer the varchar to int and succeed iff the form of the varchar is legal </li><li>数据的长度应在列的<strong>规定范围</strong>内，例如:不能将一个长度为80的字符串加入到长度为40的列中。</li><li>在values中列出的数据位置必须与被加入的列的排列位置相对应。</li><li>字符和日期型数据应包含在单引号中。</li><li>列可以插入空值[ <strong>前提是该字段允许为空</strong> ]，insert into table value(null)</li><li>insert into tab name(列名..)values 0.0).()形式添加多条记录</li><li>如果是给表中的所有字段添加数据,可以不写前面的字段名称</li><li>默认值的使用，当不给某个字段值时，如果有默认值就会添加，否则报错</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE goods(id int,goods_name VARCHAR(20) NOT NULL DEFAULT 100,    # goods_name is not allowed to be assigned null toprice INT )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. insert a record, assign varchar to int， mysql will try to transfer the varchar to int and succeed iff the form of varchar is legalINSERT INTO goods (id, goods_name, price) VALUES('30', 'book', 2000);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 6. insert more than one record in one command INSERT INTO goods (id, goods_name, price) VALUES('30', 'book', 2000), (20, 'huawei', 3000);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 7. 如果是给表中的所有字段添加数据,可以不写前面的字段名称INSERT INTO goods VALUES('30', 'book', 2000);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 8 默认值的使用，当不给某个字段值时，如果有默认值就会添加，否则报错# 如果我们希望指定某个列的默认值，可以在创建表时指定INSERT INTO goods (id, goods_name) VALUES('30', 'book');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="NO-2-更新数据"><a href="#NO-2-更新数据" class="headerlink" title="NO.2 更新数据"></a>NO.2 更新数据</h2><p>如果没有带Where条件，会修改所有的记录，要慎重</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE tbl _name SET col_name1 = expr1 [ , col_name2=expr2 ...J[WHERE where_definition]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906201943041.png" alt="image-20220906201943041"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># price = price + 1000是可以允许这样写的UPDATE goods SET price = price + 1000 WHERE price = 2000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li>==UPDATE==语法可以用新值更新原有表行中的各列。</li><li>==SET==子句指示要修改哪些列和要给予哪些值。</li><li>==WHERE==子句指定应更新哪些行。如没有WHERE子句，则更新所有的行。</li><li>如果需要修改多个字段,可以通过set字段1=值1，字段2=值2……</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">UPDATE goods SET goods_name = 'sam', id = id + 3 WHERE goods_name = 'book';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="NO-3-删除数据"><a href="#NO-3-删除数据" class="headerlink" title="NO.3 删除数据"></a>NO.3 删除数据</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DELETE FROM goods WHERE `goods_name` = 'sam';DELETE FROM goods; #删除所有记录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li>如果不使用where子句，将删除表中所有数据。</li><li>Deleté语句==不能删除某一列的值==（可使用==update设为null或者”==）</li><li>使用delete语句仅删除记录，不删除表本身。如要删除表，使用droptable语句。drop table 表名;</li></ol><h2 id="NO-4-选择数据"><a href="#NO-4-选择数据" class="headerlink" title="NO.4 选择数据"></a>NO.4 选择数据</h2><h3 id="1-选择列"><a href="#1-选择列" class="headerlink" title="1. 选择列"></a>1. 选择列</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT [DISTINCT] {column1,column2 . column3. . } FROM tablename;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>Select 指定查询哪些列的数据</li><li>column指定列名。</li><li>*号代表查询所有列。</li><li>From指定查询哪张表。</li><li>DISTINCT可选,指显示结果时,是否去掉重复数据</li></ol><p>student表</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906204849291.png" alt="image-20220906204849291"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># select allSELECT * FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>就和上面的一样，全部显示</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># select specified columnsSELECT chinese, `name` FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906211702581.png" alt="image-20220906211702581"></p><table><thead><tr><th align="center">SELECT english FROM student;</th><th align="center">SELECT DISTINCT english FROM student;</th></tr></thead><tbody><tr><td align="center"><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111115039971.png" alt="image-20230111115039971"></td><td align="center"><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111115043840.png" alt="image-20230111115043840"></td></tr></tbody></table><p>distinct只有当所有的元素都一样的时候，才会去重，比如说查看id 和 name， 只有当id和name都一样的时候才会去重</p><h3 id="2-操作列之后选择"><a href="#2-操作列之后选择" class="headerlink" title="2. 操作列之后选择"></a>2. 操作列之后选择</h3><p>可以对列进行操作之后，比如加法减法等等操作时候再选择</p><p>operate the column</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># separate with ,SELECT * l { column1 / expression , column2 l expression，..}FROMtablename;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>各个列之间用逗号隔开</p><h3 id="3-别名"><a href="#3-别名" class="headerlink" title="3. 别名"></a>3. 别名</h3><p>为类起别名</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT columnname as 别名 from 表名;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然这个as是可以省略的</p><h3 id="4-示例"><a href="#4-示例" class="headerlink" title="4. 示例"></a>4. 示例</h3><ol><li>统计每个学生的总分</li><li>在所有学生总分加10分的情况</li><li>使用别名表示学生分数。</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 统计每个学生的总分SELECT `name`, (chinese + english + math) FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906213338888.png" alt="image-20220906213338888"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 在所有学生总分加10分的情况SELECT `name`, (chinese + english + math + 10) FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906213407778.png" alt="image-20220906213407778"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 使用别名表示学生分数SELECT `name` AS '名字', (chinese + english + math + 10) AS scores FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>英文名字就不用加单引号了</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906213531029.png" alt="image-20220906213531029"></p><h3 id="5-where-筛选"><a href="#5-where-筛选" class="headerlink" title="5. where 筛选"></a>5. where 筛选</h3><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111115352008.png" alt="image-20230111115352008"></p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><ol><li>查询姓名为赵云的学生成绩</li><li>查询英语成绩大于90分的同学</li><li>查询总分大于200分的所有同学</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM student WHERE `name` = '赵云';SELECT * FROM student WHERE english &gt; 90;SELECT * FROM student WHERE (chinese + english + math) &gt; 200;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906214144641.png" alt="image-20220906214144641"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906214153506.png" alt="image-20220906214153506"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906214200827.png" alt="image-20220906214200827"></p><ol><li>查询math大于60并且(and) id大于90的学生成绩</li><li>查询英语成绩大于语文成绩的同学</li><li>查询总分大于200分并且数学成绩小于语文成绩,的姓张的学生.</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 查询math大于60并且(and) id大于4的学生成绩SELECT * FROM student WHERE math &gt; 60 and id &gt; 4;# 2. 查询英语成绩大于语文成绩的同学SELECT * FROM student WHERE english &gt; chinese;# 3. 查询总分大于200分并且数学成绩小于语文成绩,的姓张的学生.SELECT * FROM student WHERE (chinese + math + english) &gt; 200 and math &lt; chinese and `name` LIKE '韩%';  # 韩%表示名字以韩开头的就行 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111115458257.png" alt="image-20230111115458257"></th></tr></thead><tbody><tr><td><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111115502946.png" alt="image-20230111115502946"></td></tr><tr><td><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111115508446.png" alt="image-20230111115508446"></td></tr></tbody></table><ol><li>查询英语分数在80 - 90之间的同学</li><li>查询数学分数为89,90,91的同学</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 查询英语分数在80 - 90之间的同学SELECT * FROM student WHERE english &gt;= 80 and english &lt;= 90;SELECT * FROM student WHERE english BETWEEN 80 AND 90; # between是闭区间# 2. 查询数学分数为89,90,91的同学SELECT * FROM student WHERE math = 89 or math = 90 or math = 91;SELECT * FROM student WHERE math IN (89, 90, 91);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-order-by-排序"><a href="#6-order-by-排序" class="headerlink" title="6. order by 排序"></a>6. order by 排序</h3><h4 id="升序降序"><a href="#升序降序" class="headerlink" title="升序降序"></a>升序降序</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT column1 , column2 . column3 . .FROM table;order by column asc|desc,...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol><li>Order by指定排序的列，排序的列既可以是表中的列名，也可以是select语句后指定的列名。</li><li>Asc升序[默认]、Desc降序</li><li>ORDER BY子句应位于SELECT语句的==结尾==。</li></ol><h5 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h5><ol><li>对数学成绩排序后输出【升序】,默认就是升序</li><li>对总分按从高到低的顺序输出</li><li>对姓李的学生成绩排序输出(升序)</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 对数学成绩排序后输出【升序】SELECT * FROM student ORDER BY math; # asc default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906220111304.png" alt="image-20220906220111304"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 对总分按从高到低的顺序输出SELECT `name`, (chinese + math + english) AS total_score FROM student ORDER BY total_score DESC;# 前面是as total_score 后面也可以用total_score<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906220358821.png" alt="image-20220906220358821"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 对姓韩的学生成绩排序输出(升序)SELECT `name`, (chinese + math + english) AS total_score FROM student WHERE `name` LIKE '李%' ORDER BY total_score DESC;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220906220836582.png" alt="image-20220906220836582"></p><h1 id="七、函数"><a href="#七、函数" class="headerlink" title="七、函数"></a>七、函数</h1><h2 id="NO-1-聚合函数"><a href="#NO-1-聚合函数" class="headerlink" title="NO.1 聚合函数"></a>NO.1 聚合函数</h2><p>我们先来看数据</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111115715652.png" alt="image-20230111115715652"></p><h3 id="1-count"><a href="#1-count" class="headerlink" title="1. count"></a>1. count</h3><p>count return the total mumber of columns</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select count（*)|count(column_name) from table_name[WHEREwhere _definition]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li>统计一个班级共有多少学生?</li><li>统计数学成绩大于90的学生有多少个?</li><li>统计总分大于250的人数有多少?</li><li>count(*)和count(column_name)的区别</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 统计一个班级共有多少学生?SELECT COUNT(*) FROM student;# 2. 统计数学成绩大于90的学生有多少个?SELECT COUNT(*) FROM student WHERE math &gt; 90;# 3. 统计总分大于250的人数有多少?SELECT COUNT(*) FROM student WHERE (chinese + english + math) &gt; 250;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>==count(*) &amp; count(column_name)==</p><ol start="4"><li>count(*)和count(column_name)的区别</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907094923560.png" alt="image-20220907094923560"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT COUNT(`name`) FROM t15 WHERE math &gt;= 30; // 3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT COUNT(*) FROM t15 WHERE math &gt;= 30;  // 4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>count(column_name) 会 跳过那些column_name列为空的情况</p><h3 id="2-sum"><a href="#2-sum" class="headerlink" title="2. sum"></a>2. sum</h3><p> sum return sum of column which meets where condition</p><p>==sum is commonly used for num columns, only number can add==</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select sum(column expression) FROM table WHERE ...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>统计一个班级数学总成绩?</li><li>统计一个班级语文、英语、数学各科的总成绩</li><li>统计一个班级语文、英语、数学的成绩总和</li><li>统计一个班级语文成绩平均分</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 统计一个班级数学总成绩SELECT sum(math) FROM t15;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907100234220.png" alt="image-20220907100234220"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 2. 统计一个班级语文、英语、数学各科的总成绩SELECT sum(math) AS math_total_score, sum(english) AS english_total_score, sum(chinese) AS chinese_total_score FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907100457303.png" alt="image-20220907100457303"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 3. 统计一个班级语文成绩平均分SELECT sum(chinese) / COUNT(*) FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907100448547.png" alt="image-20220907100448547"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 4. 统计一个班级语文、英语、数学的成绩总和SELECT sum(chinese + math + english) FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907100434670.png" alt="image-20220907100434670"></p><p>注意：</p><ol><li>sum(string) has no sense</li><li>==seperate multiple sum with ,==</li></ol><h3 id="3-avg"><a href="#3-avg" class="headerlink" title="3. avg"></a>3. avg</h3><ol><li>求一个班级数学平均分</li><li>求一个班级总分平均分</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 求一个班级数学平均分SELECT AVG(math) FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907100757027.png" alt="image-20220907100757027"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 2. 求一个班级总分平均分SELECT AVG(math + english + chinese) FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907100833945.png" alt="image-20220907100833945"></p><h3 id="4-max-min"><a href="#4-max-min" class="headerlink" title="4. max/min"></a>4. max/min</h3><p>求班级的最高分和最低分</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT max(math + english + chinese), min(math + english + chinese) FROM student;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101012881.png" alt="image-20220907101012881"></p><h3 id="5-group-by-amp-having"><a href="#5-group-by-amp-having" class="headerlink" title="5. group by &amp; having"></a>5. group by &amp; having</h3><p>==就是对所得的语句进行分组处理，having是对得到的分组进行过滤==</p><ol><li>使用group by子句对列进行分组</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT column1 , column2 . column3. . FROM tablegroup by column<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>使用having子句对分组后的结果进行过滤</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT column1 , column2 . column3 . .FROM tablegroup by column having ..<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101741169.png" alt="image-20220907101741169"></p><p>下面的是==emp表==，是员工，上面的dept是部门，下面的slagrade是薪资水平</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101521351.png" alt="image-20220907101521351"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101820141.png" alt="image-20220907101820141"></p><ol><li>显示每个部门的平均工资和最高工资</li><li>显示每个部门的每种岗位的平均工资和最第工资</li><li>显示平均工资低于200o的部门号和它的平均工资 //别名</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 显示平均工资和最高工资SELECT AVG(sal), MAX(sal), deptno FROM emp GROUP BY deptno;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907154902311.png" alt="image-20220907154902311"></p><p>按照部门deptno来区分的</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 2. 显示每个部门的每种岗位的平均工资和最低工资SELECT AVG(sal), MIN(sal), deptno FROM emp GROUP BY deptno;# 显示每个部门每种岗位的平均工资和最低工资# (写sql语句的就是化繁为简，先显示平均工资和最低工资，再按照岗位分)SELECT AVG(sal), MIN(sal), deptno, job FROM emp GROUP BY deptno, job;  # add two group, ordered by deptno first, then job<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907155056280.png" alt="image-20220907155056280"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907155239440.png" alt="image-20220907155239440"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT AVG(sal), MIN(sal), deptno, job FROM emp GROUP BY job, deptno;# pay attention to the order of job and deptno<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907160412949.png" alt="image-20220907160412949"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示平均工资低于200o的部门号和它的平均工资# SELECT AVG(sal), deptno FROM emp WHERE AVG(sal) &lt; 2000 GROUP BY deptno;  WHERE is wrongSELECT AVG(sal) AS avg_sal, deptno FROM emp GROUP BY deptno HAVING avg_sal &lt; 2000;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907160856450.png" alt="image-20220907160856450"></p><h2 id="NO-2-字符串函数"><a href="#NO-2-字符串函数" class="headerlink" title="NO.2 字符串函数"></a>NO.2 字符串函数</h2><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907161332954.png" alt="image-20220907161332954"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT CHARSET(ename) FROM emp; # 显示每个记录的ename的字符集SELECT CONCAT(ename, '\'s  job  is ', job) FROM emp; # 将每个记录对应的字符串拼接起来SELECT INSTR('abcping','ping') FROM DUAL;  # 寻找ping在这个记录里面出现的位置，没有返回0，# DUEL是亚元表，作为测试表使用，可以填入常量么SELECT UCASE(ename) FROM emp; # 转换成大写SELECT LCASE(ename) FROM emp; # 转换成小写SELECT LEFT(ename, 2) FROM emp; # 返回左边的两个字符集SELECT RIGHT(ename, 2) FROM emp; # 返回右边的两个字符集SELECT LENGTH('abc') FROM emp; # 可以使用常量作为参数，这样的话行数就是emp的行数，但是内容与其无关SELECT ename, REPLACE(job,'MANAGER','经理') FROM emp; # ename 和 job都会显示的，在job中，manager全部替换为经理SELECT ename, STRCMP(job, deptno) FROM emp;#比较job和deptno是否不同，不同的话返回1，否则返回-1， 这个会受到collate 的影响SELECT SUBSTRING(ename, 1, 2) FROM emp;#取出ename从第一个位置开始取出两个字符，如果没有第二个参数就是后面所有的SELECT LTRIM(' abc') FROM emp;  #去掉左边的空格 RTRIM()是去右边的空格，TRIM()是所有的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 练习:以首字母小写的方式显示所有员工emp表的姓名SELECT CONCAT(LCASE(SUBSTRING(ename, 1, 1)), SUBSTRING(ename, 2)) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="NO-3-数学函数"><a href="#NO-3-数学函数" class="headerlink" title="NO.3 数学函数"></a>NO.3 数学函数</h2><table><thead><tr><th>declaration</th><th>function</th></tr></thead><tbody><tr><td>ABS(num)</td><td>绝对值</td></tr><tr><td>BIN(decimal_number )</td><td>十进制转二进制</td></tr><tr><td>CEILING (number2 )</td><td>向上取整,得到比num2大的最小整数</td></tr><tr><td>CONV(number2,from_base,to_base)</td><td>进制转换,number2是form_base进制的，转成to_base进制的</td></tr><tr><td>FLOOR(number2 )</td><td>向下取整,得到比 num2小的最大整数</td></tr><tr><td>FORMAT (number,decimal_places )</td><td>保留小数位数，抄出来的四舍五入</td></tr><tr><td>HEX(DecimalNumber )</td><td>转十六进制</td></tr><tr><td>LEAST (number , number2 […])</td><td>求最小值</td></tr><tr><td>MOD (numerator ,denominator )</td><td>求余</td></tr><tr><td>RAND([seed])</td><td>RAND([seed])其范围为[0, 1]，如果加了种子，每次会返回随机数，但是多次调用的结果是固定的</td></tr></tbody></table><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ABS(-10) FROM DUAL;SELECT BIN(13) FROM DUAL;SELECT CEILING(-1.4) FROM DUAL;SELECT CONV(10,2,10) FROM DUAL;SELECT CONV(16,16,10) FROM DUAL;SELECT FLOOR(1.3) FROM DUAL;SELECT FORMAT(13,3) FROM DUAL;SELECT FORMAT(13.13123,2) FROM DUAL;SELECT LEAST(1,3,-3) FROM DUAL;SELECT RAND(3) FROM DUAL;SELECT RAND(4) FROM DUAL;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-4-日期函数"><a href="#NO-4-日期函数" class="headerlink" title="NO.4 日期函数"></a>NO.4 日期函数</h2><table><thead><tr><th>name</th><th>function</th></tr></thead><tbody><tr><td>CURRENT_DATE( )</td><td>当前日期</td></tr><tr><td>CURRENT_TIME( )</td><td>当前时间</td></tr><tr><td>URRENT_TIMESTAMP( )</td><td>当前时间戳</td></tr><tr><td>DATE (datetime )</td><td>返回datetime的日期部分</td></tr><tr><td>DATE_ADD (date2, INTERVAL d_value unit)</td><td>在date2中加上日期或时间</td></tr><tr><td>DATE_SUB (date2 , INTERVAL d_value unit)</td><td>在date2上减去一个时间</td></tr><tr><td>DATEDIFF(date1 ,date2 )</td><td>两个日期差(结果是天)</td></tr><tr><td>TIMEDIFF(date1,date2)</td><td>两个时间差(多少小时多少分钟多少秒)</td></tr><tr><td>Now( )</td><td>==当前时间，时间戳会在更改的时候也会改变的，但是now不会==</td></tr><tr><td>YEAR|Month|Date(datetime)<br>FROM_UNIXTIMEO</td><td>年月日</td></tr><tr><td>unix_timestamp()</td><td>返回1970-1-1到现在的秒数</td></tr><tr><td>FROM_UNIXTIME()</td><td>把unix_timestamp转换成制定格式的日期<br>==意义:在开发中，可以存放一个整数，然后表示时间，通过FROM_UNIXTIME转换==，有的时候如果在java中用int保存时间，就是为了这个</td></tr></tbody></table><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT CURRENT_DATE() FROM DUAL;  #2022-09-07SELECT CURRENT_TIME() FROM DUAL;  #17:32:46SELECT CURRENT_TIMESTAMP() FROM DUAL;  #2022-09-07 17:32:52SELECT NOW() FROM DUAL; #时间戳会在更改的时候也会改变的，但是now不会<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE mes(id INT,content VARCHAR(30),send_time DATETIME);INSERT INTO mes VALUES(1, 'hello', CURRENT_TIMESTAMP());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>显示所有留言信息，发布日期只显示日期，不用显示时间</li><li>请查询在10分钟内发布的帖子</li><li>请在mysql的sql语句中求出2011-11-11和1990-1-1相差多少天</li><li>请用mysql 的sql语句求出你活了多少天(00年1月1日出生 假设)</li><li>如果你能活80岁，求出你还能活多少天(00年1月1日出生 假设)</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907174007387.png" alt="image-20220907174007387"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示所有留言信息，发布日期只显示日期，不用显示时间SELECT id, content, DATE(send_time) AS date FROM mes;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907174208539.png" alt="image-20220907174208539"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 请查询在10分钟内发布的帖子SELECT * FROM mes WHERE DATE_ADD(send_time, interval 10 MINUTE) &gt;= NOW();SELECT * FROM mes WHERE DATE_SUB(NOW(),INTERVAL 10 MINUTE) &lt;= send_time;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907174447678.png" alt="image-20220907174447678"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 请在mysql的sql语句中求出2011-11-11和1990-1-1相差多少天SELECT DATEDIFF('2011-11-11', '1990-01-01') FROM DUAL;# 多少年SELECT DATEDIFF('2011-11-11', '1990-01-01') / 365 FROM DUAL;# 取整的话也可以<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 请用mysql 的sql语句求出你活了多少天(00年1月1日出生 假设)SELECT DATEDIFF(NOW(),'2000-01-01') FROM DUAL;# 2. 如果你能活80岁，求出你还能活多少天(00年1月1日出生 假设)SELECT DATEDIFF(DATE_ADD('2000-01-01',INTERVAL 80 YEAR),NOW()) FROM DUAL;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT YEAR(NOW()) FROM DUAL;SELECT MONTH(NOW()) FROM DUAL;SELECT DATE(NOW()) FROM DUAL;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT UNIX_TIMESTAMP() FROM DUAL;SELECT FROM_UNIXTIME(unix_timestamp(), '%Y-%m-%d %H:%i:%s');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="NO-5-加密-amp-系统函数"><a href="#NO-5-加密-amp-系统函数" class="headerlink" title="NO.5 加密 &amp; 系统函数"></a>NO.5 加密 &amp; 系统函数</h2><p>密码一定要加密</p><table><thead><tr><th>name</th><th>function</th></tr></thead><tbody><tr><td>USER()</td><td>查询用户名称和IP，display other users if they are operating remotely</td></tr><tr><td>DATABASE()</td><td>数据库名称</td></tr><tr><td>MD5(str)</td><td>为字符串算出一个MD5 32的字符串，(常用于给客户输入的密码加密）不论是什么密码，加密后长度都是32位</td></tr><tr><td>PASSWORD(str)</td><td>从原文密码str计算并返回密码字符串,通常用于对mysql数据库的<strong>用户密码</strong>加密</td></tr><tr><td>SELECT * FROM mysql.user;</td><td>view the user, and the password is code by PASSWORD() method<br><strong>table_name.user</strong></td></tr></tbody></table><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT USER() FROM DUAL;  # root@localhostSELECT DATABASE() FROM DUAL;SELECT MD5('hello') FROM DUAL; # 5d41402abc4b2a76b9719d911017c592SELECT PASSWORD('hello') FROM DUAL; #*6B4F89A54E2D27ECD7E8DA05B4AB8FD9D1D8B119<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># usage of MD5()CREATE TABLE `user` (id INT,`name` VARCHAR(32) NOT NULL DEFAULT '',pwd CHAR(32) NOT NULL DEFAULT '');INSERT INTO `user` VALUES(1, 'jack', MD5('pwd'));SELECT * FROM `user`;SELECT * FROM `user`WHERE `name` = 'jack' AND pwd = MD5('pwd');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-6-if-case函数"><a href="#NO-6-if-case函数" class="headerlink" title="NO.6 if case函数"></a>NO.6 if case函数</h2><table><thead><tr><th>name</th><th>function</th></tr></thead><tbody><tr><td>IF(expr1,expr2,expr3)</td><td>如果expr1为True ,则返回expr2否则返回expr3, similar to ？：</td></tr><tr><td>IFNULL(expr1,expr2)</td><td>如果expr1不为空NULL,则返回expr1,否则返回expr2</td></tr><tr><td>SELECT CASE <br>WHEN expr1 THEN expr2<br>WHEN expr3 THEN expr4 ELSE expr5<br>END;</td><td>如果expr1 为TRUE,则返回expr2,如果expr2为t,返回expr4，否则返回expr5</td></tr></tbody></table> <pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT IF(TRUE,'HELP','NOT') FROM DUAL;SELECT IFNULL(NULL,'hello') FROM DUAL;SELECT IFNULL('notnull','hello') FROM DUAL;SELECT CASE WHEN TRUE THEN 'jack'WHEN FALSE THEN 'mary'WHEN FALSE THEN 'bob'ELSE 'FALSE'ENDFROM DUAL;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907193111598.png" alt="image-20220907193111598"></p><ol><li>查询emp表,如果comm是null，则显示0.0</li><li>如果emp表的job是CLERK则显示职员，如果是MANAGER则显示经理如果是SALESMAN则显示销售人员,其它正常显示.</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, comm FROM emp;# 如果comm是null，则显示0.0SELECT ename, if(comm IS NULL, 0.0, comm) FROM emp;SELECT ename, IFNULL(comm, 0.0) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>==using <strong>IS NULL</strong> to judge whether it is null or not==</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如果emp表的job是CLERK则显示职员，如果是MANAGER则显示经理如果是SALESMAN则显示销售人员,其它正常显示.SELECT ename, (SELECT CASE WHEN job = 'CLERK' THEN '职员'WHEN job = 'MANAGER' THEN '经理'WHEN job = 'SALESMAN' THEN '销售人员'END) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="八、查询-高级"><a href="#八、查询-高级" class="headerlink" title="八、查询(高级)"></a>八、查询(高级)</h1><p>先来看数据</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101741169-167343961804360.png" alt="image-20220907101741169"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101521351-167343961981362.png" alt="image-20220907101521351"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101820141-167343962204064.png" alt="image-20220907101820141"></p><h2 id="NO-1-查询条件"><a href="#NO-1-查询条件" class="headerlink" title="NO.1 查询条件"></a>NO.1 查询条件</h2><h3 id="1-where"><a href="#1-where" class="headerlink" title="1. where"></a>1. where</h3><p>使用where子句</p><ol><li>如何查找1992.1.1后入职的员工</li><li>如何使用 like 操作符<br>%:表示0到多个字符<br>_：表示单个任意字符</li><li>如何显示首字符为S的员工姓名和工资</li><li>如何显示第三个字符为大写O的所有员工的姓名和工资</li><li>如何显示没有上级的雇员的情况</li><li>查询表结构</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如何查找1992.1.1后入职的员工SELECT * FROM emp WHERE hiredate &gt; '1992-01-01';# 如何显示首字符为S的员工姓名和工资SELECT `ename` , sal FROM emp WHERE `ename` LIKE 'S%';#  如何显示第三个字符为大写O的所有员工的姓名和工资SELECT `ename` , sal FROM emp WHERE `ename` LIKE '__O%';# 如何显示没有上级的雇员的情况SELECT * FROM emp WHERE mgr IS NULL;# 查询表结构DESC emp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-order-by"><a href="#2-order-by" class="headerlink" title="2. order by"></a>2. order by</h3><ol><li>如何按照工资的从低到高的顺序，显示雇员的信息</li><li>按照部门号升序而雇员的工资降序排列，显示雇员信息</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如何按照工资的从低到高的顺序，显示雇员的信息SELECT * FROM emp ORDER BY sal;# 按照部门号升序而雇员的工资降序排列，显示雇员信息SELECT * FROM emp ORDER BY deptno, sal DESC;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907203149783.png" alt="image-20220907203149783"></p><h3 id="3-分页查询"><a href="#3-分页查询" class="headerlink" title="3. 分页查询"></a>3. 分页查询</h3><p>when the data is too huge, displaying all the data in the meanwhile is impossible and will resume huge resource</p><ol><li>按雇员的id号升序取出，每页显示3条记录，请分别显示第一页，第二页,第三页</li><li>基本语法:select … limit start, rows<br>表示从==start+1==行开始取,取出rows行, start 从0开始计算<br>每页显示记录数*〈第几页-1)，每页显示记录数</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">--推导一个公式SELECT * FROM empORDER BY empnoLIMIT 每页显示记录数*〈第几页-1)，每页显示记录数# 但是在LIMIT中不能使用表达式，只能是数字，在java中可以<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">-- frist pageSELECT * FROM emp ORDER BY empno LIMIT 0, 3;-- second pageSELECT * FROM emp ORDER BY empno LIMIT 3, 6;-- third pageSELECT * FROM emp ORDER BY empno LIMIT 6, 9;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-分组查询-group-by"><a href="#4-分组查询-group-by" class="headerlink" title="4. 分组查询 group by"></a>4. 分组查询 group by</h3><ol><li>显示每种岗位的雇员总数、平均工资。</li><li>显示雇员总数，以及获得补助的雇员数。</li><li>显示没有获得奖金的雇员数</li><li>显示管理者的总人数。</li><li>显示雇员工资的最大差额。</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示每种岗位的雇员总数、平均工资。SELECT COUNT(*) , job , AVG(sal) FROM emp GROUP BY job;# 显示雇员总数，以及获得补助的雇员数。SELECT COUNT(*) , COUNT(comm) FROM emp;# 显示没有获得奖金的雇员数SELECT (COUNT(*) - COUNT(comm)) FROM emp;SELECT COUNT(IF(comm IS NULL,1,NULL)) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示没有获得奖金的雇员数SELECT COUNT(IF(comm IS NULL,1,NULL)) FROM emp;# 如果这行为空，那么就是1不为空，如果不为空，那么返回的是NULL，就是空<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="5-深入理解"><a href="#5-深入理解" class="headerlink" title="5. 深入理解"></a>5. 深入理解</h3><h4 id="1-count-1"><a href="#1-count-1" class="headerlink" title="(1) count"></a>(1) count</h4><ol><li><p>count就相当于是遍历每一行进行计数吧，如果是*就是每一行都会记上去</p></li><li><p>如果有列名的话就判断这一行的这一列的数据是否为空，空的话就不统计了</p></li><li><p>count括号里面实际上是含有这一行数据的表达式，表达式不为空就计算出</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT COUNT(1) FROM emp; # legal，each row will be counted<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>因此上面的IF(comm IS NULL,1,NULL)就成立了</p></li></ol><h4 id="2-select"><a href="#2-select" class="headerlink" title="(2) select"></a>(2) select</h4><ol><li><p>查询就相当于遍历</p></li><li><p>select后面跟的实际上都是表达式，是含有值的表达式，如果是列名的话就将这一列视作是变量，表达式都是可以输出的</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT IF(comm IS NULL,1,NULL) AS exp, comm FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907211912566.png" alt="image-20220907211912566"></p></li><li><p>select后面跟着的变量，是遍历每一行，根据每一行的数据计算得到的，后面跟着几个变量就输出几个，同时也说明，<del>行是不可跳过的</del>不对，可以使用having跳过行</p></li></ol><h4 id="3-表达式的返回值"><a href="#3-表达式的返回值" class="headerlink" title="(3) = 表达式的返回值"></a>(3) = 表达式的返回值</h4><p>返回值是1 或者是 0， 但是都不是 null</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">job = 'CLERK'# 如果成立，返回的是1， 不成立返回的是0， 但是二者都不是null，像count判断的就是是不是null，其他的结果都不算是null，因此要判断这个的话SELECT COUNT(IF(job = 'CLERK', 1, NULL)) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示管理者的总人数。就是manager或者是presidentSELECT COUNT(IF(job = 'MANAGER' OR job = 'PRESIDENT',1,NULL)) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4-distinct"><a href="#4-distinct" class="headerlink" title="(4) distinct"></a>(4) distinct</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 上面的题意我理解错了，就是数有多少种mgrSELECT COUNT(DISTINCT mgr) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这个就很好理解，就是count distinct mgr，翻译过来就是数不同的mgr有多少种么</p><h4 id="5-max-min-avg"><a href="#5-max-min-avg" class="headerlink" title="(5) max min avg"></a>(5) max min avg</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示雇员工资的最大差额。SELECT (MAX(sal) - MIN(sal)) FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这两个方法都是处理一列的，如果你只想得到一列所有数据的处理结果的话，就是这样的，像AVG也是这个意思</p><h4 id="6-group-by"><a href="#6-group-by" class="headerlink" title="(6) group by"></a>(6) group by</h4><ol><li>group by合并的是具有列计算结果的组，比如说max min avg这些，都是对列进行操作的，这样才能分组，分成组后分别进行列操作</li><li>所以，如果只是像select这样的话，是不能记性行操作的</li><li>同时，按照job分的，也可以输出job</li><li>也就是说，如果使用group by的话，select的选择只能是group by的那个元素以及聚合函数（统计函数），要不然不同的元素合并不到一起</li><li>如果真的要实现的话，可以使用<strong>多表查询的自连接和子查询实现</strong></li><li>如果select有了聚合函数，并且还有另一个column，那么必须将这个column作为group by，否则合并不起来</li></ol><h4 id="7-having"><a href="#7-having" class="headerlink" title="(7) having"></a>(7) having</h4><p>​        <strong>如果HAVING的条件不满足，就会跳过这一行，不论是在遍历行输出或者是列计算的时候</strong><br>​        也就是说，想要跳过这一行，就要用having</p><h5 id="having-amp-where-区别"><a href="#having-amp-where-区别" class="headerlink" title="having &amp; where 区别"></a>having &amp; where 区别</h5><ul><li>Where是一个约束声明，在查询数据库的结果返回之前对数据库中的查询条件进行约束，即在结果返回之前起作用，且where后面不能使用<a href="https://so.csdn.net/so/search?q=%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0&amp;spm=1001.2101.3001.7020">聚合函数</a>，聚合函数就是对列进行的统计函数</li><li>Having是一个过滤声明，所谓过滤是在查询数据库的结果返回之后进行过滤，即在结果返回之后起作用，并且having后面可以使用聚合函数。</li><li>就是如果你要查平均值，并且输出平均值大于1000的，那么就要用having，因为having可以得到求出的平均值</li><li>但是如果你要计算工资大于1000的平均值，那么就要用where来约束</li><li>一个是约束行，约束的行不能参加计算，所以不能使用aggregation function，一个是过滤行，仅仅是根据结果进行过滤</li><li>所以一般约束都用where，实际上也算是一种过滤，过滤结果使用having，一般就在group by后面使用having吧</li></ul><h3 id="书写顺序"><a href="#书写顺序" class="headerlink" title="书写顺序"></a>书写顺序</h3><p>如果select语句同时包含有group by ,having , limit，order by那么他们的顺序是group by , having , orderby,limit</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT expr1, expr2, expr3. . FROM table_namegroup by columnhaving conditionorder by columnlimit start, rows;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 应用案例:请统计各个部门的平均工资，并且是大于1000的,并且按照平均工资从高到低排序，取出前两行记录.SELECT AVG(sal) AS avg_sal, deptno FROM empGROUP BY deptnoHAVING avg_sal &gt; 1000ORDER BY avg_sal DESCLIMIT 0, 2;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-2-多表查询"><a href="#NO-2-多表查询" class="headerlink" title="NO.2 多表查询"></a>NO.2 多表查询</h2><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908084741800.png" alt="image-20220908084741800"></p><ol><li>这个评论是在评论表中</li><li>商品名称是在商品表中</li><li>要从两个表中取出信息整合到一块</li></ol><p>多表查询是指基于两个和两个以上的表查询.在实际应用中,查询单个表可能不能满足你的需求</p><p>先来看看数据</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101741169-167343963443669.png" alt="image-20220907101741169"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101521351-167343963591971.png" alt="image-20220907101521351"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101820141-167343963914873.png" alt="image-20220907101820141"></p><p>要求：</p><ol><li>显示雇员名,雇员工资及所在部门的名字【笛卡尔集】<br>小技巧:多表查询的条件不能少于表的个数-1，否则会出现笛卡尔集</li><li>如何显示部门号为10的部门名、员工名和工资</li><li>显示各个员工的姓名,工资,及其工资的级别</li></ol><h3 id="1-笛卡尔集"><a href="#1-笛卡尔集" class="headerlink" title="1. 笛卡尔集"></a>1. 笛卡尔集</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># just add two table after from separated with ,SELECT * FROM dept, emp;# and two table is mutiplied<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908090556857.png" alt="image-20220908090556857"></p><ol><li>by default, directly select two table</li><li>and two table is <strong>multiplied</strong> and the columns is merged</li><li>this conclusion is called ==Descartes set==</li><li>==这个对后面的理解是很有帮助的，多表处理实际上就是对这个大表进行单表处理==</li></ol><h3 id="2-过滤条件"><a href="#2-过滤条件" class="headerlink" title="2. 过滤条件"></a>2. 过滤条件</h3><ol><li>use where statement to filter unwanted record</li><li>table.column to distinglish the same column from different table </li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal, dname FROM emp, deptWHERE emp.deptno = dept.deptno;# table.column to distinglish the same column from different table <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT emp.ename, emp.sal, dept.dname FROM emp, deptWHERE emp.deptno = dept.deptno;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="过滤条件的个数"><a href="#过滤条件的个数" class="headerlink" title="过滤条件的个数"></a>过滤条件的个数</h4><ol><li>the number of filter condition is down to ==the number of table - 1==(each condition corresponds two table), otherwise the Descartes set occurs; </li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如何显示部门号为10的部门名、员工名和工资SELECT dept.dname, emp.ename, emp.sal FROM emp, deptWHERE emp.deptno = dept.deptno AND emp.deptno = 10;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示各个员工的姓名,工资,及其工资的级别SELECT emp.ename, emp.sal, salgrade.grade FROM emp, salgrade WHERE emp.sal &gt;= salgrade.losal AND emp.sal &lt;= salgrade.hisal;SELECT emp.ename, emp.sal, salgrade.grade FROM emp, salgrade WHERE emp.sal BETWEEN salgrade.losal AND salgrade.hisal;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>最开始，直接显示两个表的话，就是两个表想成得到的表</li><li>此时，==使用where就是对这个大表进行每行的过滤==</li><li>emp.sal &gt;= salgrade.losal AND emp.sal &lt;= salgrade.hisal这个语句，就是对一行进行过滤的</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示雇员名,雇员工资及所在部门的名字,并按部部门排序[降序排]SELECT emp.ename, emp.sal, dept.dname FROM emp, deptWHERE emp.deptno = dept.deptno ORDER BY emp.deptno DESC;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-自连接"><a href="#3-自连接" class="headerlink" title="3. 自连接"></a>3. 自连接</h3><ol><li>是指在同一张表的连接查询【将==同一张表看做两张表==】</li><li>问：显示公司员工和他的上级的名字（员工和上级都在同一张表）</li><li>使用同一张表是需要别名的,就是为了区别前后的条件</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM table1 alias1, table1 alias2;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT worker.ename, boss.ename FROM emp worker, emp bossWHERE worker.mgr = boss.empno;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>使用别名来区别两张相同的表</p><h2 id="NO-3-子查询-嵌套查询"><a href="#NO-3-子查询-嵌套查询" class="headerlink" title="NO.3 子查询(嵌套查询)"></a>NO.3 子查询(嵌套查询)</h2><ol><li>子查询是指嵌入在其它sql语句中的select语句,也叫嵌套查询单行子查询</li></ol><h3 id="1-单行子查询"><a href="#1-单行子查询" class="headerlink" title="1. 单行子查询"></a>1. 单行子查询</h3><ol><li>单行子查询是指只返回一行数据的子查询语句<br>请思考:如何显示与SMITH同一部门的所有员工</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如何显示与SMITH同一部门的所有员工# 1. get the deptno of smith's deptSELECT deptno FROM emp WHERE ename = 'SMITH';  # 一般写写出select的结果# 2. nest the deptnoSELECT * FROM empWHERE deptno = (SELECT deptno FROM emp WHERE ename = 'SMITH')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-多行子查询"><a href="#2-多行子查询" class="headerlink" title="2. 多行子查询"></a>2. 多行子查询</h3><ol><li><p>多行子查询<br>多行子查询指返回多行数据的子查询使用关键字==in==</p></li><li><p>课堂练习:</p><p>如何查询和部门10的工作相同的雇员的名字、岗位、工资、部门号，但是不含10号部门自己的雇员.</p></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如何查询和部门10的工作相同的雇员的名字、岗位、工资、部门号，但是不含10号部门自己的雇员.# 1. 得到10号部分的部门集合，这个时候使用到distinctSELECT DISTINCT job FROM emp WHERE deptno = 10;# 2. 嵌套进去SELECT ename, job, sal, deptno FROM empWHERE job in (SELECT DISTINCT job FROM empWHERE deptno = 10) ANDdeptno != 10;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-all-amp-any"><a href="#1-all-amp-any" class="headerlink" title="(1) all &amp; any"></a>(1) all &amp; any</h4><p>在多行子查询中可以使用all和any这个函数</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示工资比部门30的所有员工的工资高的员工的姓名、工资和部门号SELECT ename, sal, deptno FROM empWHERE sal &gt; all(SELECT sal FROM empWHERE deptno = 30)SELECT ename, sal, deptno FROM empWHERE sal &gt; (SELECT MAX(sal) FROM empWHERE deptno = 30)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>使用聚合函数的得到的是一个值，==使用聚合函数的效率是比较高的==，==因为可以减少比较次数==</li><li>直接选择得到的是一个集合</li><li>&gt;&nbsp;all (set) 就是大于这个集合中所有的</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如何显示工资比部门30的其中一个员工的工资高的员工的姓名、工资和部门号，也就是大于最低的SELECT ename, sal, deptno FROM empWHERE sal &gt; (SELECT MIN(sal) FROM empWHERE deptno = 30)SELECT ename, sal, deptno FROM empWHERE sal &gt; ANY(SELECT sal FROM empWHERE deptno = 30)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-子查询当做临时表"><a href="#3-子查询当做临时表" class="headerlink" title="3. 子查询当做临时表"></a>3. 子查询当做临时表</h3><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908101908447.png" alt="image-20220908101908447"></p><p>有一个商品表，得到各个类别中，价格最高的商品</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 这是筛选出来要输出的信息，cat_id表示类别SELECT goods_id, cat_id, goods_name, shop_priceFROM ecs_goods;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 然后要找出各个类别中价格最高的，就要先找出各个类别的最高价格SELECT cat_id, MAX(shop_price) AS max_price FROM ecs_goodsGROUP BY cat_id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908102124311.png" alt="image-20220908102124311"></p><ol><li>这两张表都是从同一张表中得到的字表，然后就是将两张字（当然也可以使用原始的大表的）表拼接起来</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT goods_id, ecs_goods.cat_id, goods_name, ecs_goods.shop_price FROM(SELECT cat_id, MAX(shop_price) AS max_price FROM ecs_goodsGROUP BY cat_id) temp , ecs_goods WHERE temp.cat_id = ecs_goods.cat_id AND temp.max_price = ecs_goods.shop_price;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>tips:子表中的==聚合函数可以起别名==，方便后面使用<br>子表的名字就==命名为temp==吧，就是临时表</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908103155683.png" alt="image-20220908103155683"></p><h3 id="4-多列子查询"><a href="#4-多列子查询" class="headerlink" title="4. 多列子查询"></a>4. 多列子查询</h3><ol><li>我们之前子查询得到的只有一列</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT deptno FROM emp WHERE ename = 'SMITH';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>比如说这个，得到的就是deptno这一个列</p><ol start="2"><li>多列子查询就是得到多列，其实可以说，==原先得到的是单一类型的结合，现在得到的是含有多种类型的表==</li></ol><p>==问：==请思考如何查询与allen的部门和岗位完全相同的所有雇员(并且不含smith本人)(字段1，字段2.…)= (select字段1，字段2 from。.。。)，==集合进行比较，要求字段完全相同==</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 得到的job 和 deptnoSELECT job, deptno FROM emp WHERE ename = 'ALLEN';# 2. 进行比较SELECT * FROM emp WHERE (job, deptno) = (SELECT job, deptno FROM empWHERE ename = 'ALLEN') ANDename != 'ALLEN'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-在from子句中使用子查询"><a href="#5-在from子句中使用子查询" class="headerlink" title="5. 在from子句中使用子查询"></a>5. 在from子句中使用子查询</h3><p>例一：</p><p>请思考:查找每个部门工资高于本部门平均工资的人的资料</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># get avg_sal and deptnoSELECT AVG(sal) AS avg_sal , deptno FROM empGROUP BY deptno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal, emp.sal FROM emp, (SELECT AVG(sal) AS avg_sal , deptno FROM empGROUP BY deptno) tempWHERE emp.deptno = temp.deptno AND emp.sal &gt; temp.avg_sal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>but the selected expression cannot be * because two table is merge</p><p>例二:</p><p>查找每个部门工资最高的人的资料</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 得到每个部门最高的工资SELECT MAX(sal), deptno FROM empGROUP BY deptno;# 然后是选择SELECT ename, sal, emp.deptnoFROM emp, (SELECT MAX(sal) AS max_sal, deptno FROM empGROUP BY deptno) temp WHERE emp.deptno = temp.deptnoAND emp.sal = temp.max_sal;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>例三：</p><p>查询每个部门的信息(包括:部门名,编号,地址)和人员数量,我们一起完成。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># get the number of each deptSELECT COUNT(*) , deptno FROM empGROUP BY deptno;# nest the subquery in the from table SELECT dept.dname, dept.deptno, dept.loc, temp.`count` AS `count`FROM dept, (SELECT COUNT(*) AS `count`, deptno FROM empGROUP BY deptno) tempWHERE temp.deptno = dept.deptno# pay attention the table.column 的table和column都对着不<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-table"><a href="#6-table" class="headerlink" title="6. table.*"></a>6. table.*</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT temp.*, dname, locFROM dept, (SELECT COUNT(*) AS `count`, deptno FROM empGROUP BY deptno) tempWHERE temp.deptno = dept.deptno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>table.*可以显示一个表的所有的列，同时可以把别名带出来</p><h2 id="NO-4-合并查询结果"><a href="#NO-4-合并查询结果" class="headerlink" title="NO.4 合并查询结果"></a>NO.4 合并查询结果</h2><h3 id="1-union-all-不取消重复行"><a href="#1-union-all-不取消重复行" class="headerlink" title="1. union all 不取消重复行"></a>1. union all 不取消重复行</h3><p>union all doesn’t remove duplicate</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal, job FROM emp WHERE sal &gt; 2500;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal, job FROM emp WHERE job = 'MANAGER';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th><img src="../../%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20220908143334025.png" alt="image-20220908143334025"></th><th><img src="../../%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20220908143339929.png" alt="image-20220908143339929"></th></tr></thead></table><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal, job FROM emp WHERE sal &gt; 2500UNION ALLSELECT ename, sal, job FROM emp WHERE job = 'MANAGER';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908143402421.png" alt="image-20220908143402421"></p><h3 id="2-去重合并"><a href="#2-去重合并" class="headerlink" title="2. 去重合并"></a>2. 去重合并</h3><p>the usage is same with union all but union remove duplicate record</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal, job FROM emp WHERE sal &gt; 2500UNION SELECT ename, sal, job FROM emp WHERE job = 'MANAGER';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908143514288.png" alt="image-20220908143514288"></p><h1 id="九、表复制"><a href="#九、表复制" class="headerlink" title="九、表复制"></a>九、表复制</h1><h2 id="NO-1-自我复制-蠕虫复制"><a href="#NO-1-自我复制-蠕虫复制" class="headerlink" title="NO.1 自我复制(蠕虫复制)"></a>NO.1 自我复制(蠕虫复制)</h2><p>有时，为了对某个sql语句进行效率测试，我们需要海量数据时，可以使用此法为表创建海量数据。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t16(id INT,`name` VARCHAR(32),sal DOUBLE,job VARCHAR(32),deptno INT);INSERT INTO t16 (id, `name`, sal, job, deptno)SELECT empno, ename, sal, job, deptno FROM emp;# 将得到的字表插入到新表中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者也可以如下简写</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO t16 SELECT * FROM t16;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="NO-2-去除重复数据"><a href="#NO-2-去除重复数据" class="headerlink" title="NO.2 去除重复数据"></a>NO.2 去除重复数据</h2><p>classic interview problem</p><ol><li>create a temp table with same structure with origin table</li><li>manage origin table with ==distinct== and assign new table to temp</li><li>clear origin table</li><li>copy the temp table to the origin table</li><li>drop temp table</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO t16 SELECT * FROM t16; # *10CREATE TABLE temp LIKE t16;INSERT INTO temp SELECT DISTINCT * FROM t16;DELETE FROM t16;INSERT INTO t16 SELECT * FROM temp;DROP TABLE temp;SELECT * FROM t16;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>就是用distinct将不同的记录提取到另一张表中</p><h1 id="十、外连接"><a href="#十、外连接" class="headerlink" title="十、外连接"></a>十、外连接</h1><ol><li>前面我们学习的查询，是利用where子句对两张表或者多张表，形成的笛卡尔积进行筛选，根据关联条件，显示所有匹配的记录，匹配不上的，不显示</li><li>比如:列出部门名称和这些部门的员工名称和工作，同时要求显示出那些没有员工的部门。</li><li>使用我们学习过的多表查询的SQL,看看效果如何?</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101741169-167343966146281.png" alt="image-20220907101741169"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101521351-167343966346683.png" alt="image-20220907101521351"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101820141-167343966563685.png" alt="image-20220907101820141"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT dname, ename, jobFROM emp, deptWHERE emp.deptno = dept.deptnoORDER BY dname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908144205035.png" alt="image-20220908144205035"></p><p>only three dept are displayed, in fact, there are four depts but OPERATIONS has no employee</p><p>有一个部门由于没有员工所以没有列出来</p><h2 id="左外连接-右外连接"><a href="#左外连接-右外连接" class="headerlink" title="左外连接\右外连接"></a>左外连接\右外连接</h2><ol><li><p>左外连接(如果==左侧的表完全显示==我们就说是==左外连接==)</p></li><li><p>右外连接(如果==右侧的表完全显示==我们就说是==右外连接==)</p><p>为了讲清楚,我们举例说明。</p></li></ol><table><thead><tr><th align="center">left table std</th><th align="center">right table exam</th></tr></thead><tbody><tr><td align="center"><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111191315968.png" alt="image-20230111191315968"></td><td align="center"><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230111191320261.png" alt="image-20230111191320261"></td></tr></tbody></table><ol><li>使用左连接(显示所有人的成绩，如果没有成绩，也要显示该人的姓名和id号,成绩显示为空)</li><li>右连接(显示所有成绩，如果没有名字匹配，显示空)</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT std.id, `name`, gradeFROM std, examWHERE std.id = exam.id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908152544621.png" alt="image-20220908152544621"></p><p>nono has no grade and isn’t displayed</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># left outer connectionSELECT std.id, `name`, gradeFROM std LEFT JOIN examON std.id = exam.id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908152554336.png" alt="image-20220908152554336"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 右连接(显示所有成绩，如果没有名字匹配，显示空)SELECT std.id, `name`, gradeFROM std RIGHT JOIN examON std.id = exam.id;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908152621853.png" alt="image-20220908152621853"></p><p>==关键是看要完全显示哪一个，表2是完全显示就是right connection==</p><p>==左连接和右连接和显示顺序无关，显示顺序只和select后面的标签一致==</p><p>==在实际开发中，我们绝大多数学过的是内连接，左右外连接在面试的时候用的比较多==</p><h3 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h3><p>列出部门名称和这些部门的员工信息(名字和工作)，同时列出那些没有员工的部门名。</p><ol><li>使用左外连接实现</li><li>使用右外连接实现</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># right outer connectionSELECT dept.deptno, dept.dname, ename FROM emp RIGHT JOIN deptON emp.deptno = dept.deptnoORDER BY dept.deptno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT dept.deptno, dept.dname, ename FROM dept LEFT JOIN empON emp.deptno = dept.deptnoORDER BY dept.deptno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="十一、约束"><a href="#十一、约束" class="headerlink" title="十一、约束"></a>十一、约束</h1><p>约束用于确保==数据库的数据满足特定的商业规则==。在mysql中，约束包括: not null、unique、primary key、foreign key、和check五种.</p><h2 id="NO-1-主键-primary-key"><a href="#NO-1-主键-primary-key" class="headerlink" title="NO.1 主键 primary key"></a>NO.1 主键 primary key</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE table_name (field type primary key)# 用于唯一的标示表行的数据,当定义主键约束后，该列不能重复# field symbolize a column but not row<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t17 (id INT PRIMARY KEY,`name` VARCHAR(32),email VARCHAR(32));INSERT INTO t17 VALUES (1, 'jack', 'jack@qq.com');INSERT INTO t17 VALUES (2, 'bob', 'def@qq.com');# INSERT INTO t17 VALUES (1, 'mary', 'abc@qq.com'); fails<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>说明：</p><ol><li><p>primary key不能重复而且==不能为null==。</p></li><li><p>一张表最多==只能有一个主键==，但可以是==复合主键==</p></li><li><p>主键的指定方式有两种</p><ul><li><p>直接在==字段名后指定==: 字段名primakry key</p></li><li><p>在==表定义最后==写  primary key(列名);</p></li></ul></li><li><p>使用desc表名，可以看到primary key的情况<br>==more than on key means composite key but not two key== </p></li><li><p>general , every table has primary key ：几乎每个表都有主键</p></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 符合组件，将id和name合起来看做主键CREATE TABLE t18 (id INT,`name` VARCHAR(32),email VARCHAR(32),PRIMARY KEY(id, `name`) # composite key)# iff both id and name are the same ,the second record cannot be added INSERT INTO t18 VALUES (1, 'tom', 'tom@qq.com');INSERT INTO t18 VALUES (1, 'jack', 'tom@qq.com');# INSERT INTO t18 VALUES (1, 'tom', 'tom2@qq.com'); fails<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># two way to define primary key CREATE TABLE t19 (id INT PRIMARY KEY,`name` VARCHAR(32))CREATE TABLE t19 (id INT,`name` VARCHAR(32),PRIMARY KEY(id))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># DESC table show the primary keyDESC t18;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="复合主键"><a href="#复合主键" class="headerlink" title="复合主键"></a>复合主键</h3><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908161430170.png" alt="image-20220908161430170"></p><p>==more than on key means composite key but not two key==</p><h2 id="NO-2-不允许为空-not-null"><a href="#NO-2-不允许为空-not-null" class="headerlink" title="NO.2 不允许为空 not null"></a>NO.2 不允许为空 not null</h2><p>如果在列上定义了not null,那么当插入数据时，必须为列提供数据。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE table_name (field type not null)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="NO-3-唯一-unique"><a href="#NO-3-唯一-unique" class="headerlink" title="NO.3 唯一 unique"></a>NO.3 唯一 unique</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t19 (id INT UNIQUE, # id cannot be duplicate `name` VARCHAR(32),email VARCHAR(32),)INSERT INTO t19 VALUES (1, 'jack', 'jack@qq.com');# INSERT INTO t19 VALUES (1, 'tom', 'jack@qq.com'); fails<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>说明：</p><ol><li>如果没有指定not null ，则unique 字段可以有多个null，也就是null可以重复，一个列可以有多个null</li><li>==if a column is unique and not null，it is the same with primary key==：如果一个列是 unique的并且是 not null的，就和主键一样</li><li>一张表可以有==多个unique字段==</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t19 (id INT UNIQUE,`name` VARCHAR(32) UNIQUE,email VARCHAR(32),)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-4-外键-foreign-key"><a href="#NO-4-外键-foreign-key" class="headerlink" title="NO.4 外键 foreign key"></a>NO.4 外键 foreign key</h2><ol><li>用于定义主表和从表之间的关系:<br>外键约束要定义在从表上，被外键指向的column必须则必须是==主键约束==或是==unique约束==.,<br>当定义外键约束后，要求外键列数据必须在主表的主键列存在或是为null(学生/班级图示)</li><li>在创建从表的时候定义外键，所以先定义主表</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908163704269.png" alt="image-20220908163704269"></p><ol><li>学生表的class_id 对应着班级表的id，那么我么可以把class_id做成外键</li><li>外键class_id要求值必须在班级的id集合中，如果班级id只有200和100，那么添加的第三行class_id = 300就无法添加成功</li><li>反过来，<strong>如果学生表中有200与班级表对应，则无法删除班级表中id为200的班级，除非删除掉学生表的200class_id的记录</strong></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE class (id INT UNIQUE, # the column pointed by foreign ket must be unique or primary key`name` VARCHAR(32) NOT NULL DEFAULT '',`add` VARCHAR(32));CREATE TABLE stds (id INT PRIMARY KEY,`name` VARCHAR(32) NOT NULL DEFAULT '',class_id INT,FOREIGN KEY(class_id) REFERENCES class(id));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO class VALUES (100, 'java', '北京'),  (200, 'web', '上海');INSERT INTO stds VALUES (1, 'tom', 100), (2, 'jack', 200);# INSERT INTO stds VALUES (3, 'bob', 300); fails<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908164627090.png" alt="image-20220908164627090"></p><p>说明：</p><ol><li>外键指向的表的字段，要求是primary key或者是unique</li><li>表的引擎是==innodb==,这样的表才支持外键</li><li>外键字段的类型要和主键字段的==类型一致==(长度可以不同)</li><li>外键字段的值，必须在主键字段中出现过，或者为null[前提是外键字段允许为null]</li><li>一旦建立主外键的关系，数据不能随意删除了.</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO stds VALUES (3, 'bob', null); # null is permited<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="NO-5-检查-check"><a href="#NO-5-检查-check" class="headerlink" title="NO.5 检查 check"></a>NO.5 检查 check</h2><ol><li>用于强制行数据必须满足的条件.</li><li>假定在sal列上定义了check约束,并要求sal列值在1000 ~2000之间如果不再1000 ～2000之间就会提示出错。</li><li>oracle和sql server均支持check ,但是mysql5.7目前还不支持check ,只做语法校验，但不会生效。==语法上是支持的，但是不会生效==</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t19 (id INT PRIMARY KEY,`name` VARCHAR(32),sex VARCHAR(6) CHECK (sex IN('man', 'woman')),sal DOUBLE CHECK(sal &gt; 1000 AND sal &lt; 2000));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO  t19 VALUES (1, 'jack', 'mid', 1);# success, mysql只有语法，但是不会生效<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h2><p>现有一个商店的数据库shop_db，记录客户及其购物情况，由下面三个表组成:</p><ul><li>商品goods(商品号goods_id，商品名goods_name，单价unitprice，商品类别category，供应商provider);</li><li>客户customer(客户号customer_id,姓名name,住址address,电邮email性别sex,身份证card_ld);</li><li>购买purchase （购单号order_id，客户号customer_id,商品号goods_id,购买数量nums);</li></ul><p>建表,在定义中要求声明[进行合理设计]:</p><ol><li>每个表的主外键;</li><li>客户的姓名不能为空值;</li><li>电邮不能够重复;</li><li>客户的性别[男女]</li><li>单价unitprice在1.0 - 9999.99之间check</li></ol><p>分析</p><ol><li>id是主键</li><li>商品goods的商品号是外键，客户的客户号是外键，指向purchase</li><li>客户的姓名不能为空，not null</li><li>性别限制  ==ENUM==</li><li>单价设置check</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE purchase (order_id INT PRIMARY KEY,customer_id INT UNIQUE,goods_id INT UNIQUE,nums INT UNSIGNED);CREATE TABLE goods (goods_id INT PRIMARY KEY,goods_name VARCHAR(32) NOT NULL DEFAULT '',unitprice DECIMAL(10, 2) NOT NULL DEFAULT 0 CHECK (unitprice &gt;= 1.0 AND unitprice &lt;= 9999.99) ,category INT NOT NULL DEFAULT 0,provider VARCHAR(32) NOT NULL DEFAULT '',FOREIGN KEY(goods_id) REFERENCES purchase(goods_id));CREATE TABLE customer (customer_id INT PRIMARY KEY,`name` VARCHAR(32) NOT NULL DEFAULT '',address VARCHAR(32),email VARCHAR(32) UNIQUE,sex ENUM('man', 'woman') NOT NULL,card_id INT NUIQUE,FOREIGN KEY(customer_id) REFERENCES purchase(customer_id));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>unsigend , not null , ENUM, 这些都要好好用</p><h2 id="NO-6-自增-不算约束"><a href="#NO-6-自增-不算约束" class="headerlink" title="NO.6 自增(不算约束)"></a>NO.6 自增(不算约束)</h2><p>这个不算是约束，但是归到这里来了</p><ol><li>在某张表中，存在一个id列(整数),我们希望在添加记录的时候,该列从1开始，自动的增长，怎么处理? </li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE table_name (field type auto_increment;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>添加自增长的字段方式</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. assigned null to fieldinsert into xxx(字段1，字段2.…) values(null,'值'..…);insert into xxx values(null,'值1'....…)    # 2. doesn't assign value to fieldinsert into xxx(字段2....) values(值1,'值2'..…);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t20 (id INT PRIMARY KEY AUTO_INCREMENT,email VARCHAR(32) NOT NULL DEFAULT '',`name` VARCHAR(32) NOT NULLDEFAULT '');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO t20 VALUES(NULL, 'jack@qq.com', 'tom');INSERT INTO t20 (`name`, email) VALUES('jack@qq.com', 'tom')INSERT INTO t20 VALUES(NULL, 'jack@qq.com', 'tom');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908174905084.png" alt="image-20220908174905084"></p><p>说明：</p><ol><li><p>==—般来说==自增长是和primary key配合使用的</p></li><li><p>自增长也可以单独使用[但是需要配合一个unique]</p></li><li><p>自增长修饰的字段为整数型的(虽然小数也可以但是非常非常<br>少这样使用)</p></li><li><p>自增长默认从1开始，你也可以通过如下命令修改</p><p>alter table 表名 auto increment =新的开始值;</p></li><li><p>如果添加数据的时候，给自增长制定具体的值，则以制定的值为准,并且==以后的自增长从这个值开始==，一般不这么做</p></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t21 (id INT PRIMARY KEY AUTO_INCREMENT,email VARCHAR(32) NOT NULL DEFAULT '',`name` VARCHAR(32) NOT NULLDEFAULT '');ALTER TABLE t21 AUTO_INCREMENT = 100;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="十二、索引"><a href="#十二、索引" class="headerlink" title="十二、索引"></a>十二、索引</h1><h2 id="NO-1-介绍"><a href="#NO-1-介绍" class="headerlink" title="NO.1 介绍"></a>NO.1 介绍</h2><p>​    说起提高数据库性能，索引是最物美价廉的东西了。不用加内存，(但是会增大文件大小，就是硬盘大小)，不用改程序，不用调sql，查询速度就可能提高百倍干倍。</p><p>创建800w的数据表 emp</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM emp WHERE empno = 1234568;# resume 4.5s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># add index on ompnoCREATE INDEX empno_index ON emp(empno)SELECT * FROM emp WHERE empno = 1234568;# resume 0.03s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>但是索引只会对加了索引的column提升速度</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM emp WHERE ename = 'name'; # resume 4.7sCREATE INDEX ename_index ON emp(ename)SELECT * FROM emp WHERE ename = 'name'; # quicke<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol><li>创建索引会增大磁盘占用空间</li><li>但是会加快查询速度</li><li>只有加了索引的地方才会加快查询速度</li></ol><h2 id="NO-2-原理-amp-代价"><a href="#NO-2-原理-amp-代价" class="headerlink" title="NO.2 原理 &amp; 代价"></a>NO.2 原理 &amp; 代价</h2><ol><li>当我们没有索引的时候，查找的时候会从头到尾扫描</li><li>加了索引之后，会形成一棵二叉树<br>（二叉树根据插入的顺序，树的样子是不一样的）</li><li>但是索引也会占用空间，导致磁盘占用变大</li><li>同时也会对update，delete，insert语句会有影响的，查询变快，dml变慢</li><li>但是，在项目中，select的操作是要比dml更多的，前者几乎要占90%的</li></ol><h2 id="NO-3-分类"><a href="#NO-3-分类" class="headerlink" title="NO.3 分类"></a>NO.3 分类</h2><h3 id="1-主键索引"><a href="#1-主键索引" class="headerlink" title="1. 主键索引"></a>1. 主键索引</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t1 (id INT PRIMARY KEY,  # id is also a indexname VARCHAR(32))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>添加了 primary key，就自动成为索引了（主键自动为索引）</p><h3 id="2-unique索引"><a href="#2-unique索引" class="headerlink" title="2. unique索引"></a>2. unique索引</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t1 (id INT UNIQUE, # unique indexname VARCHAR(32))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果认为id这个值不会重复，并且希望能够查询的快一些，就添加的是唯一索引</p><h3 id="3-普通索引"><a href="#3-普通索引" class="headerlink" title="3. 普通索引"></a>3. 普通索引</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE INDEX id_index ON t25(id);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果会重复也希望查询快就普通索引</p><h3 id="4-全文索引"><a href="#4-全文索引" class="headerlink" title="4. 全文索引"></a>4. 全文索引</h3><p>全文索引，就是在文章中搜索内容的时候使用</p><p>一般开发不适用mysql自带的全文索引，而是使用：全文搜索Solr和ElastiSearch（ES）</p><h2 id="NO-4-使用"><a href="#NO-4-使用" class="headerlink" title="NO.4 使用"></a>NO.4 使用</h2><h3 id="1．添加索引"><a href="#1．添加索引" class="headerlink" title="1．添加索引"></a>1．添加索引</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create [UNIQUE]index index_name on tbl_name (col_ name K(length)J[ASC | DESC] , .…..…);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">alter table table_name ADD INDEX[index name] (index col_name,.…)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-添加主键-索引"><a href="#2-添加主键-索引" class="headerlink" title="2. 添加主键(索引)"></a>2. 添加主键(索引)</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE 表名ADD PRIMARY KEY(列名..);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-删除索引"><a href="#3-删除索引" class="headerlink" title="3. 删除索引"></a>3. 删除索引</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP INDEX index name ON tbl_name;alter table table_name drop index index_name;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="删除主键索引"><a href="#删除主键索引" class="headerlink" title="删除主键索引"></a>删除主键索引</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">alter table t_b drop primary key;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-查看索引"><a href="#4-查看索引" class="headerlink" title="4. 查看索引"></a>4. 查看索引</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SHOW INDEXES FROM t25;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h3><ol><li>创建：主键索引的操作都是ALTER，其他的可以使CREATE</li><li>删除：主键索引是ALTER  TABLE table DROP PRIMARY, 其他的是 DROP INDEX index_name ON table</li></ol><h4 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a>练习1</h4><h5 id="add-index"><a href="#add-index" class="headerlink" title="add index"></a>add index</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t25 (id INT,`name` VARCHAR(32));# view indexSHOW INDEXES FROM t25;# add unique index on idCREATE UNIQUE INDEX id_index ON t25(id);# add common index on id#可能会重复并且希望查询快就用普通indexCREATE INDEX id_index ON t25(id);ALTER TABLE t25 ADD INDEX id_index(id);# add primary key indexCREATE TABLE t1 (id INT PRIMARY KEY,  # id is also a indexname VARCHAR(32))ALTER TABLE t25 ADD PRIMARY KEY(id); # without id_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="delete-index"><a href="#delete-index" class="headerlink" title="delete index"></a>delete index</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP INDEX id_index ON t25;# id_index is index name but not column index# delete primary indexALTER TABLE t25 DROP PRIMARY KEY;# attention : KET but not INDEX, and doesn't specific the index name because primary key is unique<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="update-index"><a href="#update-index" class="headerlink" title="update index"></a>update index</h5><p>delete old index + add new index</p><h5 id="quere-index"><a href="#quere-index" class="headerlink" title="quere index"></a>quere index</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SHOW INDEX FROM t25;SHOW INDEXES FROM t25;SHOW KETS FROM t25;# three ways above display the same conclusionDESC t25;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="练习2-索引分类"><a href="#练习2-索引分类" class="headerlink" title="练习2(索引分类)"></a>练习2(索引分类)</h4><h5 id="1-primary-index"><a href="#1-primary-index" class="headerlink" title="1. primary index"></a>1. primary index</h5><p>创建一张订单表order (id号，商品名,订购人，数量).要求id号为主键，请使用2种方式来创建主键.(提示:为练习方便，可以是order1 , order2)</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t26 (id INT PRIMARY KEY,goods_name VARCHAR(32) NOT NULL DEFAULT '',subscriber VARCHAR(32) NOT NULL DEFAULT '',NUM INT UNSIGNED);SHOW INDEX FROM t26;ALTER TABLE t26 DROP PRIMARY KEY;ALTER TABLE t26 ADD PRIMARY KEY(id);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-unique-index"><a href="#2-unique-index" class="headerlink" title="2. unique index"></a>2. unique index</h5><p>​    创建一张特价菜谱表menu (id号，菜谱名,厨师，点餐人身份证，价格).要求id号为主键，点餐人身份证是unique请使用两种方式来创建unique.</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t21 (id INT UNIQUE,recipe_name VARCHAR(32) NOT NULL DEFAULT '',chef VARCHAR(32) NOT NULL DEFAULT '',card_id INT UNSIGNED,price DOUBLE UNSIGNED);# ? how to delete unique index created when the table is createdALTER TABLE t21 DROP id ON t21;CREATE UNIQUE INDEX id_index ON t21(id);DROP INDEX id_index ON t21;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-common-index"><a href="#3-common-index" class="headerlink" title="3.  common index"></a>3.  common index</h5><p>​    创建一张运动员表sportman (id号，名字，特长).要求id号为主键，名字为普通索引，请使用三种方式来创建索引(提示:为练习方便，可以是不同表名</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE sportman(id INT UNSIGNED,`name` VARCHAR(32) NOT NULL DEFAULT '',specialty VARCHAR(32) NOT NULL DEFAULT '');# add indexCREATE INDEX id_index ON sportman(id);SHOW INDEX FROM sportman;# delete indexDROP INDEX id_index ON sportman;# add indexALTER TABLE sportman ADD INDEX id_index(id);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>小结:哪些列上适合使用索引</p><ol><li>==较频繁的作为查询条件字段==应该创建索引<br>select * from emp where empno = 1</li><li>==唯一性太差的字段不适合单独创建索引==，即使频繁作为查询<br>条件<br>select * from emp where sex =”男‘，<strong>性别只有男女两个，创建索引没啥意义</strong></li><li>==更新常频繁的字段==不适合创建索引<br>select * from emp where logincount =1</li><li>==不会出现在WHERE子句中字段==不该创建索引</li></ol><h1 id="十三、事务"><a href="#十三、事务" class="headerlink" title="十三、事务"></a>十三、事务</h1><p>事务用于保证数据的一致性,它由一组相关的dml语句组成,该组的dml语句<strong>要么全部成功，要么全部失败</strong>。<br>​    如:转账就要用事务来处理，用以保证数据的一致性。</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908205120889.png" alt="image-20220908205120889"></p><h2 id="NO-1-事务和锁"><a href="#NO-1-事务和锁" class="headerlink" title="NO.1 事务和锁"></a>NO.1 事务和锁</h2><p>当执行事务操作时(dml语句),mysql会在==表上加锁==,防止其它用户改表的数据.这对用户来讲是非常重要的</p><h2 id="NO-2-事务的基本操作"><a href="#NO-2-事务的基本操作" class="headerlink" title="NO.2 事务的基本操作"></a>NO.2 事务的基本操作</h2><p>mysql 数据库控制台事务的几个重要操作</p><ol><li><p>start transaction –开始一个事务</p></li><li><p>savepoint保存点名–设置保存点</p></li><li><p>rollback to保存点名–回退事务</p></li><li><p>rollback –回退全部事务</p></li><li><p>commit–提交事务,所有的操作生效,不能回退</p></li><li><p>回退事务<br>在介绍回退事务前，先介绍一下保存点(savepoint).保存点是事务中的点.用于取消部分事务，当结束事务时(commit)，会自动的删除该事务所定义的所有保存点.当执行回退事务时，通过指定保存点可以回退到指定的点</p></li><li><p>提交事务<br>使用commit语句可以提交事务.当执行了commit语句子后,会确认事务的变化、结束事务、删除保存点、释放锁，数据生效。当使用commit语句结束事务子后，其它会话将可以查着到事务变化后的新数据（所有的数据正式，其他的连接都能看到了）</p></li></ol><h2 id="NO-3-示意图"><a href="#NO-3-示意图" class="headerlink" title="NO.3 示意图"></a>NO.3 示意图</h2><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220908211435622.png" alt="image-20220908211435622"></p><ol><li>12:00的时候commit，那么就无法回滚，并且将保存点a b都给删除掉</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t27 (id INT,`name` VARCHAR(32));# 开启事物START TRANSACTION;# set autocommit=off; also works# 设立保存点aSAVEPOINT a;INSERT INTO t27 VALUES(100, 'tom');SELECT * FROM t27;# 设立保存点bSAVEPOINT b;INSERT INTO t27 VALUES(200, 'jack');SELECT * FROM t27;# 回到保存点b那里ROLLBACK TO b;ROLLBACK TO a;# 回到开启事务那里ROLLBACK;# 提交事务COMMIT;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-4-说明"><a href="#NO-4-说明" class="headerlink" title="NO.4 说明"></a>NO.4 说明</h2><ol><li>如果不开始事务，默认情况下，dml操作是==自动提交==的，不能回滚</li><li>如果开始一个事务，你没有创建保存点.你可以执行rollback,默认就是回退到你事务开始的状态, 开启事务的时候给了默认保存点.</li><li>你也可以在这个事务中(还没有提交时),创建多个保存点.比如: savepoint：aaa; 执行dml , savepoint：bbb;</li><li>你可以在事务没有提交前，选择回退到哪个保存点.</li><li>mysql的事务机制需要==innodb的存储引擎==还可以使用,==myisam==不好使.</li><li>开始一个事务==start transaction==,==set autocommit=off==;</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">INSERT INTO t27 VALUES(300, 'jack');ROLLBACK;  # no sense because the transaction is not started<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="NO-5-事务隔离级别"><a href="#NO-5-事务隔离级别" class="headerlink" title="NO.5 事务隔离级别"></a>NO.5 事务隔离级别</h2><p>事务隔离级别介绍</p><ol><li>多个连接开启各自事务操作数据库中数据时，数据库系统要负责隔离操作，以保证各个连接在获取数据时的准确性。</li></ol><h3 id="1-出现的问题"><a href="#1-出现的问题" class="headerlink" title="1. 出现的问题"></a>1. 出现的问题</h3><ol><li><p>如果不考虑隔离性，可能会引发如下问题:</p><ul><li>脏读</li><li>不可重复读</li><li>幻读</li></ul></li><li><p>脏读(dirty read):当一个事务==读取到了==另一个事务尚未提交的修改时，产生脏读</p></li><li><p>不可重复读(nonrepeatable read):同一查询在同一事务中多次进行，由于其他提交事务所做的==修改或删除==,==每次返回不同的结果集==，此时发生不可重复读。</p></li><li><p>幻读(phantom read):同一查询在同一事务中多次进行，由于其他提交事务所做的==插入操作==,每次返回不同的结果集，此时发生幻读。</p></li></ol><p>用我自己的理解来解释一下</p><ol><li>A和B同时连接同一个数据库，两人希望分别操作数据库</li><li>脏读：A的修改还没有提交呢，B就读取到了</li><li>不可重复读：A提交了自己的修改或者删除操作，就是已经上传了，但是B还在自己的事件中未提交，但是B此时就能读到A的改变</li><li>幻读：A提交了插入操作，B还在事件中呢，但是读到了A的改变，此时就是幻读</li><li>==也就是说，上面三个等级是防止自己读取到别人的操作的，不是防止别人做的==</li><li>但是还有一个Serializable是不一样的，是加锁的，防止别人操作的</li></ol><h3 id="2-隔离级别"><a href="#2-隔离级别" class="headerlink" title="2. 隔离级别"></a>2. 隔离级别</h3><table><thead><tr><th>MysqI隔离级别(4种)</th><th>脏读</th><th>不可重复读</th><th>幻读</th><th>加锁读</th></tr></thead><tbody><tr><td>读未提交(Read uncommitted</td><td>√</td><td>√</td><td>√</td><td>不加锁</td></tr><tr><td>读已提交(Read committed)</td><td>×</td><td>√</td><td>√</td><td>不加锁</td></tr><tr><td>可重复读(Repeatable read)(==默认==)</td><td>×</td><td>×</td><td>×</td><td>不加锁</td></tr><tr><td>可串行化(Serializable )</td><td>×</td><td>×</td><td>×</td><td>加锁</td></tr></tbody></table><p>mysql 默认的事务隔离级别是repeatable read，一般情况下,没有特殊要求,没有必要修改(因为该级别可以满足绝大部分项目需求)，除非真的要serializable</p><h3 id="3-演示"><a href="#3-演示" class="headerlink" title="3. 演示"></a>3. 演示</h3><h4 id="1-读未提交"><a href="#1-读未提交" class="headerlink" title="(1) 读未提交"></a>(1) 读未提交</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">#1. log in two consoles# consoles1mysql -u root -pEnter password: ******# consoles2mysql -u root -pEnter password: ******<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># view the isolation levelselect @@tx_isolation;# consoles1  repeatable read/*+-----------------+| @@tx_isolation  |+-----------------+| REPEATABLE-READ |+-----------------+*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">#2. set the isolation level of second console to read uncommittedset session transaction isolation level read uncommitted;/*+------------------+| @@tx_isolation   |+------------------+| READ-UNCOMMITTED |+------------------+*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">#3. start transaction in two consolesstart transaction;# isolation level has no sence if the transaction doesn't start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># select database use db03;# create tableCREATE TABLE `account` (id INT,`name` VARCHAR(32),money INT)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 1  just add record but not commit transactionINSERT INTO `account` values(100, 'tom', 1000);# console 2 view the table select * from `account`;/* dirty read+------+------+-------+| id   | name | money |+------+------+-------+|  100 | tom  |  1000 |+------+------+-------+*/# console2 read the record that console doesn't commit, because console2 can read committed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 1update account set money = 2000 where id = 100;insert into account values(200, 'jack', 3000);commit;# console 1 commit the transaction<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 2 select * from account; /*+------+------+-------+| id   | name | money |+------+------+-------+|  100 | tom  |  2000 ||  200 | jack |  3000 |+------+------+-------+*/# 不可重复读和幻读，就是自己的事件还没有提交，就读到了别人插入和修改后的记录# 别人的提交影响了我对表的读取<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-读已提交"><a href="#2-读已提交" class="headerlink" title="(2) 读已提交"></a>(2) 读已提交</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 2select @@tx_isolation;/*+----------------+| @@tx_isolation |+----------------+| READ-COMMITTED |+----------------+*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># bothstart transaction;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 1insert into account values(300, 'scott', 8000);select * from account;+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |  8000 |+------+-------+-------+# console 2select * from account;+------+------+-------+| id   | name | money |+------+------+-------+|  100 | tom  |  2000 ||  200 | jack |  3000 |+------+------+-------+# console 2 cannot read the uncommitted record, but unrepeatable read and 幻读 still exists<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 1update account set money = 1800 where id = 300;select * from account;+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |  1800 |+------+-------+-------+commit;# console 2select * from account;+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |  1800 |+------+-------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-可重复读"><a href="#3-可重复读" class="headerlink" title="(3) 可重复读"></a>(3) 可重复读</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 2set session transaction isolation level repeatable read;start transaction;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">/* the table before being changed+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |  2000 ||  400 | milan |  6000 |+------+-------+-------+*/# console 1insert into account values(400, 'milan', 6000);update account set money = 2000 where id = 300;select * from account;/*+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |  2000 ||  400 | milan |  6000 ||  400 | milan |  6000 |+------+-------+-------+*/commit;# console 2select * from account;/*+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |  2000 ||  400 | milan |  6000 |+------+-------+-------+*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-可串行化"><a href="#4-可串行化" class="headerlink" title="(4) 可串行化"></a>(4) 可串行化</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 2/*+----------------+| @@tx_isolation |+----------------+| SERIALIZABLE   |+----------------+*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 1insert into account values(200, 'terry', 80000);update account set money = 900 where id = 300;select * from account;/*+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |   900 ||  400 | milan |  6000 ||  400 | milan |  6000 ||  200 | terry | 80000 |+------+-------+-------+*/# console doesn't commit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 2select * from account;# the program is blocked, cannot execute# 回车之后卡在这里了，就不能动了# ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction 报出超时<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># console 1;commit;# console 2;select * from account;+------+-------+-------+| id   | name  | money |+------+-------+-------+|  100 | tom   |  2000 ||  200 | jack  |  3000 ||  300 | scott |   900 ||  400 | milan |  6000 ||  400 | milan |  6000 ||  200 | terry | 80000 |+------+-------+-------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-操作"><a href="#4-操作" class="headerlink" title="4. 操作"></a>4. 操作</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># view isolation level of current sessionSELECT @@tx_isolation;# view isolation level of current systemselect @@global.tx_isolation;# set isoaltion level of current sessionset session transaction isolation level read uncommitted;# set isoaltion level of current systemset hlobal transaction isolation level read uncommitted;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># change default isolation level# 全局修改，修改my.ini配置文件，在最后加上# 可选参数有:READ-UNCOMMITTED,READ-COMMITTED,REPEATABLEREAD,SERIALIZABLE.[mysqld]transaction-isolation = REPEATABLE-READ(这个是要改的默认的隔离等级，之后要停止服务然后再启动)net stop mysql;net start mysql;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-事务特性：ACID"><a href="#5-事务特性：ACID" class="headerlink" title="5. 事务特性：ACID"></a>5. 事务特性：ACID</h3><p>ACID properties of transaction</p><ol><li><p>原子性(Atomicity)</p><p>是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</p></li><li><p>一致性(Consistency)<br>事务必须使数据库从一个一致性状态变换到另外一个一致性状态</p></li><li><p>隔离性(lsolation)<br>事务的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。</p></li><li><p>持久性(Durability)<br>持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响</p></li></ol><h1 id="十四、表类型和存储引擎"><a href="#十四、表类型和存储引擎" class="headerlink" title="十四、表类型和存储引擎"></a>十四、表类型和存储引擎</h1><h2 id="NO-1-基本介绍"><a href="#NO-1-基本介绍" class="headerlink" title="NO.1 基本介绍"></a>NO.1 基本介绍</h2><ol><li>MySQL的表类型由存储引擎(Storage Engines）决定，主要包括MylSAM.innoDB、Memory等。</li><li>MySQL数据表主要支持六种类型,分别是:CSV、Memory、ARCHIVE.MRG MYISAM、MYISAM、InnoBDB.</li><li>这六种又分为两类，<br>一类是”事务安全型(transaction-safe, ==support transaction==),比如:InnoDB;<br>其余都属于第二类，称为”非事务安全型”(non-transaction-safe)[mysiam和memory]。</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SHOW ENGINES;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909161622803.png" alt="image-20220909161622803"></p><h2 id="NO-2-主要存储引擎的特性"><a href="#NO-2-主要存储引擎的特性" class="headerlink" title="NO.2 主要存储引擎的特性"></a>NO.2 主要存储引擎的特性</h2><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909161711618.png" alt="image-20220909161711618"></p><ol><li><p>Memory stored in memory , so it is quick </p></li><li><p>行锁是每行都加一个锁，表锁是表加锁</p></li><li><p>memory是存在内存中的，所以存储有限制</p></li><li><p>只有InnoDB支持事务和外键</p></li><li><p>MylSAM不支持事务、也不支持外键，但其访问速度快，对事务完整性没有要求</p></li><li><p>InnoDB存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。但是比起MyISAM存储引擎，InnoDB写的处理效率差一些并且会占用更多的磁盘空间以保留数据和索引。</p></li><li><p>MEMORY存储引擎使用存在内存中的内容来创建表。每个MEMORY表只实际对应一个磁盘文件。MEMORY类型的表访问非常得快，因为它的数据是放在内存中的，并且默认使用HASH索引。但是==一旦服务关闭，表中的数据就会丢失掉,表的结构还在==，对临时表有用，有些数据就是不需要存放在文件中的。</p></li></ol><h2 id="NO-3-演示"><a href="#NO-3-演示" class="headerlink" title="NO.3 演示"></a>NO.3 演示</h2><h3 id="1-InnoDB"><a href="#1-InnoDB" class="headerlink" title="1. InnoDB"></a>1. InnoDB</h3><p>InnoDB has been used before, so we don’t display</p><ol><li>transaction supported, primary key supported , line lock</li></ol><h3 id="2-Mysiam"><a href="#2-Mysiam" class="headerlink" title="2. Mysiam"></a>2. Mysiam</h3><ol><li>==add quickly==, not primary key and transaction supported , table lock</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">START TRANSACTION;SAVEPOINT t1;INSERT INTO t28 VALUES (10, 'hello');SELECT * FROM t28;ROLLBACK TO t1; # fails, <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-Memory"><a href="#3-Memory" class="headerlink" title="3. Memory"></a>3. Memory</h3><ol><li>数据存储在内存中</li><li>执行速度很快(没有Io读写)</li><li>默认支持索引(hash表)</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE t29(id INT,`name` VARCHAR(32) ) ENGINE MEMORY;INSERT INTO t29 VALUES(1, 'tom'), (2, 'jack'), (3, 'mary');SELECT * FROM t29;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">net stop mysql;net start mysql;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DESC t29;# the structure of table still existsSELECT * FROM t29;# no records<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-4-选择"><a href="#NO-4-选择" class="headerlink" title="NO.4 选择"></a>NO.4 选择</h2><ol><li>如果你的应用不需要事务，处理的只是基本的CRUD操作，那么MylSAM是不二选择,速度快</li><li>如果需要支持事务，选择InnoDB。而且支持primary key</li><li>Memory 存储引擎就是将数据存储在内存中，由于没有磁盘I./O的等待,速度极快。但由于是内存存储引擎，所做的任何修改在服务器重启后都将消失。(经典用法==用户的在线状态==(0.)</li></ol><p>用户的在线状态是经常变化的，但是状态的保存是没有意义的，如果一个用户的状态发生变化，我们就去修改user表,而用户的状态是频繁变化，操作就非常频繁.，用户1000w，使用memory来优化</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909163557659.png" alt="image-20220909163557659"></p><p>将state分隔出来做成一个memory表</p><h2 id="NO-5-更换引擎"><a href="#NO-5-更换引擎" class="headerlink" title="NO.5 更换引擎"></a>NO.5 更换引擎</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">ALTER TABLE t29 ENGINE = INNODB;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="十五、视图"><a href="#十五、视图" class="headerlink" title="十五、视图"></a>十五、视图</h1><h2 id="NO-1-为什么使用视图"><a href="#NO-1-为什么使用视图" class="headerlink" title="NO.1 为什么使用视图"></a>NO.1 为什么使用视图</h2><p>emp表的列信息很多，有些信息是个人重要信息(比如sal, comm,mgr, hiredate)，如果我们希望某个用户只能查询emp表的(empno.ename,job和deptno )信息，有什么办法?</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909164010312.png" alt="image-20220909164010312"></p><h2 id="NO-2-介绍"><a href="#NO-2-介绍" class="headerlink" title="NO.2 介绍"></a>NO.2 介绍</h2><ol><li>视图是一个虚拟表，其内容由查询定义。虚拟表就是没有这个表，只是在查看的时候真实表给你展示了固定一块的数据，这一块就是视图。</li><li>同真实的表一样，视图包含列,其数据来自对应的真实表(基表)，<strong>一个视图可以对应多个基表</strong></li><li>通过视图可以修改基表的数据，基表的改变也会影响视图的数据，类似于变量及其引用</li><li>视图和基表关系的示意图</li></ol><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909164708878.png" alt="image-20220909164708878"></p><h2 id="NO-3-基本操作"><a href="#NO-3-基本操作" class="headerlink" title="NO.3 基本操作"></a>NO.3 基本操作</h2><h3 id="1-创建视图"><a href="#1-创建视图" class="headerlink" title="1. 创建视图"></a>1. 创建视图</h3><ol><li>create view视图名as <em><em>select语句（这个select语句返回的就是一张表，<del>所以也是可以填表的，只是没有意义</del>,只能填select得到的字表，如果select</em> 就是全部表了，通过select可以实现多表视图）</em>*</li></ol><h3 id="2-更换视图"><a href="#2-更换视图" class="headerlink" title="2. 更换视图"></a>2. 更换视图</h3><ol><li>alter view视图名as select语句</li></ol><h3 id="3-查看视图"><a href="#3-查看视图" class="headerlink" title="3. 查看视图"></a>3. 查看视图</h3><ol><li>SHOW CREATE VIEW 视图名,查看创建视图的指令</li></ol><h3 id="4-删除视图"><a href="#4-删除视图" class="headerlink" title="4. 删除视图"></a>4. 删除视图</h3><ol><li>drop view视图名1,视图名2</li></ol><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE VIEW emp_view01 AS SELECT empno, ename, job, deptno FROM emp;DESC emp_view01;SELECT * FROM emp_view01;SELECT empno, job FROM emp_view01;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SHOW CREATE VIEW emp_view01;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DROP VIEW emp_view01;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="NO-4-说明-1"><a href="#NO-4-说明-1" class="headerlink" title="NO.4 说明"></a>NO.4 说明</h2><ol><li>创建视图后，到数据库去看，对应视图只有一个视图结构文件，但是没有数据文件(形式:视图名.frm)</li><li>视图的数据变化会影响到基表，基表的数据变化也会影响到视图[insert update delete ]</li><li>视图中可以再使用视图，<strong>数据仍然来自基表..</strong></li></ol><h2 id="NO-5-特点"><a href="#NO-5-特点" class="headerlink" title="NO.5 特点"></a>NO.5 特点</h2><ol><li>安全。一些数据表有着重要的信息。有些字段是保密的，不能让用户直接看到。这时就可以创建一个视图，在这张视图中只保留一部分字段。这样，用户就可以查询自己需要的字段，不能查看保密的字段。</li><li>性能。关系数据库的数据常常会<strong>分表存储</strong>，使用<strong>外键建立这些表的之间关系</strong>。这时,数据库查询通常会<strong>用到连接(JOIN)<strong>。这样做不但麻烦，效率相对也比较低。如果建立一个视图，将相关的表和字段组合在一起，就可以</strong>避免使用JOIN查询数据</strong>。</li><li>灵活。如果系统中有一张旧的表，这张表由于设计的问题，即将被废弃。然而，很多应用都是基于这张表，不易修改。这时就可以建立一张视图，视图中的数据直接映射到新建的表。这样，就可以少做很多改动，也达到了升级数据表的目的。<br><strong>比如说</strong>：原来的数据基于A表和B表，但是他们的结构都淘汰了，可以使用视图来整合A表和B表，构建新的结构，数据指向这个视图</li></ol><h2 id="NO-6-练习"><a href="#NO-6-练习" class="headerlink" title="NO.6 练习"></a>NO.6 练习</h2><ol><li>针对emp , dept，和salgrade张三表.创建一个视图emp_view03，可以显示雇员编号，雇员名，雇员部门名称和薪水级别,</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 先select得到需要的内容，然后根据这个内容创建视图SELECT empno, ename, dept.dname, gradeFROM emp, dept, salgradeWHERE emp.deptno = dept.deptno AND emp.sal &gt;= salgrade.losal AND emp.sal &lt; salgrade.hisal;CREATE VIEW emp_view03AS SELECT empno, ename, dept.dname, gradeFROM emp, dept, salgradeWHERE emp.deptno = dept.deptno AND emp.sal &gt;= salgrade.losal AND emp.sal &lt; salgrade.hisal;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># between 更好用emp.sal BETWEEN losal AND hisal;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="十六、MySQL-用户-管理"><a href="#十六、MySQL-用户-管理" class="headerlink" title="十六、MySQL(用户)管理"></a>十六、MySQL(用户)管理</h1><h2 id="NO-1-概念"><a href="#NO-1-概念" class="headerlink" title="NO.1 概念"></a>NO.1 概念</h2><p>Mysql用广的管理</p><ol><li>原因:当我们做项目开发时，可以根据不同的开发人员，赋给他相应的Mysq1操作权限</li><li>所以，Mysql数据库管理人员(root)，根据需要创建不同的用户，赋给相应的权限，供人员使用</li></ol><p>mysql中的用户，都存储在系统数据库mysql中 user表中</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909173342474.png" alt="image-20220909173342474"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909173349858.png" alt="image-20220909173349858"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909173411840.png" alt="image-20220909173411840"></p><p>其中user表的重要字段说明:</p><ol><li>host:允许登录的“位置”，localhost表示该用户只允许本机登录,也<br>可以指定ip地址，比如:192.168.1.100</li><li>user:用户名;</li><li>authentication string:密码,是通过mysal的password()函数加密之后的密码。</li></ol><h2 id="NO-2-操作"><a href="#NO-2-操作" class="headerlink" title="NO.2 操作"></a>NO.2 操作</h2><h3 id="1-创建用户"><a href="#1-创建用户" class="headerlink" title="1. 创建用户"></a>1. 创建用户</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create user '用户名'@'允许登录位置' identified by '密码'# 说明:创建用户，同时指定密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-删除用户"><a href="#2-删除用户" class="headerlink" title="2. 删除用户"></a>2. 删除用户</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">drop user '用户名' @'允许登录位置'# mysql认为用户名+允许登录的位置才是完整的登录信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-改密码"><a href="#3-改密码" class="headerlink" title="3. 改密码"></a>3. 改密码</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># change own passwordset password = password('密码');# 修改他人的密码(需要有修改用户密码权限):set password for'用户名'@'登录位置'= password('密码');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-3-演示-1"><a href="#NO-3-演示-1" class="headerlink" title="NO.3 演示"></a>NO.3 演示</h2><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">#1．创建新的用户# 在任意库中都可以使用，但是创建的USER表最终就是在那个库中，不会在mysql库中修改，因此这个方法我们要在mysql的查找中调用CREATE USER 'jack'@'localhost' IDENTIFIED BY '123456';#解读#(1) 'jack'@'localhost'表示用户的完整信息 # 'jack′用户名 'localhost′登录的IP# (2) 123456 密码，但是注意存放到mysq1.user表时，是password ('123456') 加密后的密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 2.查看用户SELECT * FROM mysql.user;# 如果已经在mysql库中就不用加mysql了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909174946631.png" alt="image-20220909174946631">这个是加密后的密码</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 3. 删除用户DROP USER 'jack'@'localhost';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 4. 登录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909184354085.png" alt="image-20220909184354085"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909184434192.png" alt="image-20220909184434192"></p><p>这个user只能看到这些，different user，different database and table to view and operation according to different permissions</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909184722003.png" alt="image-20220909184722003"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SET PASSWORD = PASSWORD('abcdef');set password for'root'@'localhost'= password('密码');# error, denyed because permissions is not enough# root changes password of other users is permitedSET PASSWORD FOR 'jack'@'localhost' = PASSWORD( '123456')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="NO-4-权限"><a href="#NO-4-权限" class="headerlink" title="NO.4 权限"></a>NO.4 权限</h2><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909184722003-1673439745591109.png" alt="image-20220909184722003"></p><p>root can give user privilege to execute specific operation</p><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><h4 id="给用户授权"><a href="#给用户授权" class="headerlink" title="给用户授权"></a>给用户授权</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">grant 权限列表 on 库.对象名 to '用户名'@'登录位置'[identified by '密码']<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li><p>权限列表，多个权限用逗号分开</p><p>grant select on…….<br>grant select, delete , create on ……</p><p>grant all 【privileges】on ….. //表示赋予该用户在该对象上的所有权限</p></li><li><p>特别说明</p><ul><li>*.*：代表本系统中的所有数据库的所有对象(表，视图，存储过程)</li><li>库.*:表示某个数据库中的所有数据对象(表，视图，存储过程等)</li></ul></li><li><p>identified by可以省略，也可以写出.</p><ol><li>如果用户存在，就是修改该用户的密码。</li><li>如果该用户不存在，就是创建该用户!</li></ol></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">grant all on *.* to '用户名'@'登录位置'# is similar to the privilege of root <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="收回权限"><a href="#收回权限" class="headerlink" title="收回权限"></a>收回权限</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">revoke 权限列表 on 库.对象名 from '用户名"@"登录位置";<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="flush"><a href="#flush" class="headerlink" title="flush"></a>flush</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 如果权限没有生效，可以执行下面命令.基本语法:FLUSH PRIVILEGES;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="练习-4"><a href="#练习-4" class="headerlink" title="练习"></a>练习</h3><ol><li>创建一个用户(你的名字，拼音)，密码123，并且只可以从本地登录，不让远程登录mysql</li><li>创建库和表testdb下的news表,要求:使用root用户创建</li><li>给用户分配查看news表和添加数据的权限</li><li>测试看看用户是否只有这几个权限</li><li>修改密码为abc ,要求:使用root用户完成</li><li>重新登录</li><li>回收权限</li><li>使用root用户删除你的用户</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># mysqlCREATE USER 'jack'@'localhost' IDENTIFIED BY '123456';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>jack can view only system database by default;</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE DATABASE testdb;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># testdbCREATE TABLE tab (id INT,`name` VARCHAR(32))# insert a record for testingINSERT INTO tab VALUES(1, 'jack');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># mysqlGRANT SELECT, INSERTON testdb.tabTO 'sxt'@'localhost';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220909204229434.png" alt="image-20220909204229434">now the jack can view the testdb database</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># jackINSERT INTO tab VALUES(200, 'mary'); #succeedUPDATE tab SET id = 100 WHERE id = 200; # fails# 1142 - UPDATE command denied to user 'jack'@'localhost' for table 'tab'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># add privilege  rootGRANT UPDATE ON testdb.tabTO 'jack'@'localhost';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># jackUPDATE tab SET id = 100WHERE id = 200; # succeed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># change pwd rootSET PASSWORD FOR 'jack'@'localhost' = PASSWORD('abc');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>next time when jack log in, he need to input new pwd </p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># revoke privilegeREVOKE ALL ON testdb.tab FROM 'jack'@'localhost';REVOKE SELECT, UPDATE, INSERT ON testdb.tab FROM 'jack'@'localhost';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>then jack can’t view the testdb database</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># delete userDROP USER 'jack'@'localhost';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="NO-5-说明"><a href="#NO-5-说明" class="headerlink" title="NO.5 说明"></a>NO.5 说明</h2><ol><li><p>在创建用户的时候，如果不指定Host,则为%，%表示表示所有IP都有连接权限<br>create user xXAX；</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE USER 'jack'; # jack can connect the database with any ip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>你也可以这样指定<br>==create user ‘xxx‘@’192.168.1.%’==表示 xxx用户在192.168.1.*的ip可以登录mysql</p></li><li><p>在删除用户的时候，如果host不是%，需要明确指定‘用户‘@’host值’</p></li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE USER 'jack';DROP USER 'jack'; # succeedDROP USER 'jack'@'192.168.1.%';DROP USER 'jack'@'192.168.1.1';# failsDROP USER 'jack'@'192.168.1.%'; #succeed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="十七、作业"><a href="#十七、作业" class="headerlink" title="十七、作业"></a>十七、作业</h1><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101741169-1673439752490112.png" alt="image-20220907101741169"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101521351-1673439754322114.png" alt="image-20220907101521351"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20220907101820141-1673439756194116.png" alt="image-20220907101820141"></p><h2 id="1-DESC"><a href="#1-DESC" class="headerlink" title="1. DESC"></a>1. DESC</h2><p>写出查看DEPT表和EMP表的结构的sql语句</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">DESC dept;DESC emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="2-select-1"><a href="#2-select-1" class="headerlink" title="2. select"></a>2. select</h2><p>使用简单查询语句完成:</p><ol><li>显示所有部门名称。</li><li>显示所有 雇员名 及其 全年收入 13月*(工资+补助),并指定列别名”年收入“</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, (sal + IF(comm,comm,0))*13 AS 'annual_sal' # judge if the comm is nullFROM emp;SELECT ename, (sal + IFNULL(comm,0))*13 AS 'annual_sal'FROM emp;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-where"><a href="#3-where" class="headerlink" title="3. where"></a>3. where</h2><p>限制查询数据。</p><ol><li>显示工资超过2850的雇员姓名和工资。</li><li>显示工资不在1500到2850之间的所有雇员名及工资。</li><li>显示编号为7566的雇员姓名及所在部门编号。</li><li>显示部门10和30中工资超过1500的雇员名及工资。</li><li>显示无管理者的雇员名及岗位。</li><li>找出部门10中所有经理(MANAGER),部门20中所有办事员(CLERK),还有既不是经理又不是办事辰但其薪金大于或等于2000的所有员工的详细资料.</li><li>找出收取佣金的员工的不同工作.</li><li>找出不收取佣金或收取的佣金低于100的员工</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal FROM emp WHERE sal &gt; 2850;# pay attention to the command belowSELECT ename, sal FROM emp WHERE NOT(sal BETWEEN 1500 AND 2850);SELECT ename, deptno FROM emp WHERE empno = 7566;# pay attention SELECT ename, sal, deptno FROM emp WHERE sal &gt; 1500 AND deptno IN (10, 30);SELECT ename , job FROM emp WHERE mgr IS NULL;# 6. 找出部门10中所有经理(MANAGER),部门20中所有办事员(CLERK),还有既不是经理又不是办事辰但其薪金大于或等于2000的所有员工的详细资料.SELECT * FROM empWHERE (deptno = 10 AND job = 'MANAGER') OR (deptno = 20 AND job = 'CLERK')OR(NOT(job IN ('CLERK', 'MANAGER')) AND sal &gt;= 2000);# 7. 找出收取佣金的员工的不同工作.SELECT DISTINCT jobFROM empWHERE comm IS NOT NULL;# 8. 找出不收取佣金或收取的佣金低于100的员工SELECT * FROM empWHERE comm IS NOT NULL OR IFNULL(comm,0) &lt; 100;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>选择部门30中的所有员工.</li><li>列出所有办事员(CLERK)的姓名，编号和部门编号.</li><li>找出佣金高于薪金的员工.</li><li>找出佣金高于薪金60%的员工.</li><li>找出部门10中所有经理(MANAGER)和部门20中所有办事员(CLERK)的详细资料.</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 选择部门30中的所有员工.SELECT *FROM empWHERE deptno = 30;# 2. 列出所有办事员(CLERK)的姓名，编号和部门编号.SELECT ename, empno, deptnoFROM empWHERE job = 'CLERK';# 3. 找出佣金高于薪金的员工.SELECT *FROM empWHERE IFNULL(comm,0) &gt; sal;# judge if comm is null# 4. 找出佣金高于薪金60%的员工.SELECT *FROM empWHERE IFNULL(comm,0) &gt; sal*0.6;# 5. 找出部门10中所有经理(MANAGER)和部门20中所有办事员(CLERK)的详细资料.SELECT * FROM empWHERE (deptno = 10 AND job = 'MANAGER') OR (deptno = 20 AND job = 'CLERK');<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-order-by"><a href="#4-order-by" class="headerlink" title="4. order by"></a>4. order by</h2><ol><li>显示在1991年2月1日到1991年5月1日之间雇用的雇员名,岗位及雇佣日期，并以雇佣日期进行排序。</li><li>显示获得补助的所有雇员名,工资及补助,并以工资降序排序</li><li>显示所有员工的姓名、工作和薪金,按工作降序排序,若工作相同则按薪金排序.</li><li>显示员工的详细资料,按姓名排序.</li><li>显示员工的姓名和受雇日期,根据其服务年限,将最老的员工排在最前面.</li><li>==显示所有员工的姓名、加入公司的年份和月份,按受雇日期所在月排序,若月份相同则将最早年份的员工排在最前面.==</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># date betweenSELECT ename, job, hiredateFROM empWHERE hiredate BETWEEN '1991-02-01' AND '1991-05-01' ORDER BY hiredate;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ename, sal, commFROM empWHERE comm IS NOT NULLORDER BY comm DESC;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 显示所有员工的姓名、工作和薪金,按工作降序排序,若工作相同则按薪金排序.SELECT ename, job, salFROM empORDER BY job, sal;# two order <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 15. 显示员工的详细资料,按姓名排序.SELECT *FROM empORDER BY ename;# 16. 显示员工的姓名和受雇日期,根据其服务年限,将最老的员工排在最前面.SELECT ename, hiredateFROM empORDER BY hiredate;# 显示所有员工的姓名、加入公司的年份和月份,按受雇日期所在月排序,若月份相同则将最早年份的员工排在最前面.SELECT ename, YEAR(hiredate) AS `year`, MONTH(hiredate) AS `month` FROM empORDER BY `year`, `month`SELECT CONCAT(YEAR(hiredate),'-',MONTH(hiredate)) AS hiredateFROM empORDER BY MONTH(hiredate), YEAR(hiredate);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-date-function"><a href="#5-date-function" class="headerlink" title="5. date function"></a>5. date function</h2><ol start="6"><li><strong>找出各月倒数第3天受雇的所有员工.</strong></li><li><strong>找出早于12年前受雇的员工.</strong></li><li>显示满10年服务年限的员工的姓名和受雇日期.</li><li><strong>对于每个员工,显示其加入公司的天数</strong></li><li>找出在(任何年份的)2月受聘的所有员工</li><li>以年月日的方式显示所有员工的服务年限．(大概)</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 9. 找出各月倒数第3天受雇的所有员工.SELECT * FROM empWHERE LAST_DAY(hiredate) = DATE_ADD(hiredate,INTERVAL 2 DAY)SELECT * FROM empWHERE LAST_DAY(hiredate) -2 = hiredate;# 10. 找出早于12年前受雇的员工.SELECT *FROM empWHERE DATE_ADD(hiredate, INTERVAL 12 YEAR) &lt; NOW();# 显示满10年服务年限的员工的姓名和受雇日期.SELECT ename, hiredateFROM empWHERE DATE_ADD(hiredate,INTERVAL 10 YEAR) &lt; NOW();# 对于每个员工,显示其加入公司的天数？SELECT DATEDIFF(NOW(),hiredate)FROM emp;# 20. 找出在(任何年份的)2月受聘的所有员工。SELECT *FROM empWHERE MONTH(hiredate) = 2;# 以年月日的方式显示所有员工的服务年限．(大概)# get the total work day first,then divide 365SELECT ename, ROUND(DATEDIFF(NOW(),hiredate) / 365) AS work_year, ROUND(DATEDIFF(NOW(),hiredate) % 365 / 31) AS work_month, DATEDIFF(NOW(),hiredate) % 31 AS work_dayFROM emp;  # learn how to calculate year, month, day<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-string-function"><a href="#6-string-function" class="headerlink" title="6. string function"></a>6. string function</h2><ol start="11"><li>以首字母小写的方式显示所有员工的姓名.</li><li>显示正好为5个字符的员工的姓名.</li><li>显示不带有”R”的员工的姓名.</li><li>显示所有员工姓名的前三个字符.</li><li>显示所有员工的姓名,用a替换所有”A”</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 11. 以首字母小写的方式显示所有员工的姓名.SELECT CONCAT(LCASE(LEFT(ename, 1)), SUBSTRING(ename, 1)) FROM emp# 12. 显示正好为5个字符的员工的姓名.SELECT ename FROM empWHERE LENGTH(ename) = 5;# 11. 显示不带有"R"的员工的姓名.SELECT enameFROM empWHERE INSTR(ename,'R') = 0;SELECT enameFROM empWHERE ename NOT LIKE '%R%';# 12. 显示所有员工姓名的前三个字符.SELECT LEFT(ename,3) FROM emp;# 13. 显示所有员工的姓名,用a替换所有"A"SELECT REPLACE(ename,'A','a')FROM emp;# 显示姓名字段的任何位置包含"A"的所有员工的姓名.SELECT enameFROM empWHERE INSTR(ename,'A') = 0;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-number"><a href="#7-number" class="headerlink" title="7. number"></a>7. number</h2><p>显示在一个月为30天的情况所有员工的日薪金,忽略余数.</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 19. 显示在一个月为30天的情况所有员工的日薪金,忽略余数.SELECT ename, FLOOR(sal / 30)FROM empWHERE DAY(LAST_DAY(hiredate)) = 30;# round, floor is more suitableSELECT ename, ROUND(sal / 30)FROM empWHERE DAY(LAST_DAY(hiredate)) = 30;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="8-multiple-table"><a href="#8-multiple-table" class="headerlink" title="8. multiple table"></a>8. multiple table</h2><p><strong>wage = sal + comm</strong></p><ol><li>列出至少有一个员工的所有部门</li><li>列出薪金比“SMITH”多的所有员工。</li><li>列出受雇日期晚于其直接上级的所有员工。</li><li>列出部门名称和这些部门的员工信息，同时列出那些没有员工的部门。</li><li>列出所有“CLERK”(办事员)的姓名及其部门名称。</li><li>列出最低薪金大于1500的各种工作。</li><li>列出在部门“SALES”(销售部)工作的员工的姓名。</li><li>列出薪金高于公司平均薪金的所有员工。</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1. 列出至少有一个员工的所有部门# get the number of each job, 聚合函数以外的就是group by的对象SELECT COUNT(*), deptnoFROM empGROUP BY deptno;SELECT dname, dept.deptno, temp.cntFROM dept, (SELECT COUNT(*) AS cnt, deptnoFROM empGROUP BY deptno) tempWHERE temp.deptno = dept.deptno AND temp.cnt &gt; 1;# second way, try to reduce the complexity of second tableSELECT COUNT(*) AS cnt, deptnoFROM emp-- WHERE cnt &gt; 0;  where cannot contains aggregation functionGROUP BY deptnoHAVING cnt &gt; 0;# 2. 列出薪金比“SMITH”多的所有员工。# get the wage of smithSELECT sal FROM empWHERE ename = 'SMITH'SELECT emp.ename, emp.salFROM emp, (SELECT sal FROM empWHERE ename = 'SMITH') tmpWHERE emp.sal &gt; tmp.sal # 3. 列出受雇日期晚于其直接上级的所有员工。# get the mgr, ename is the employee himself, and the mgr is his direct boss, than filter out which is not his bossSELECT ename, hiredate,  mgrFROM empWHERE mgr IS NOT NULLSELECT temp.ename, temp.mgr, temp.hiredate, emp.hiredateFROM emp, (SELECT ename, hiredate, mgrFROM empWHERE mgr IS NOT NULL) tempWHERE emp.empno = temp.mgr AND emp.hiredate &lt; temp.hiredate# -----------second way-----------# use meaningful alias is benefit to distinglish two similar table, such as leader, workerSELECT worker.ename, worker.hiredate, leader.ename, leader.hiredateFROM emp leader, (SELECT mgr, ename, hiredateFROM empWHERE mgr IS NOT NULL) workerWHERE leader.empno = worker.mgrAND leader.hiredate &lt; worker.hiredate;# 4. 列出部门名称和这些部门的员工信息，同时列出那些没有员工的部门。外连接# count the number of people in each deptSELECT COUNT(*), deptnoFROM empGROUP BY deptno;# if cnt = null, output 0SELECT dept.deptno, dept.dname, IFNULL(temp.cnt, 0) AS numberFROM dept LEFT JOIN (SELECT COUNT(*) AS cnt, deptnoFROM empGROUP BY deptno) tempON dept.deptno = temp.deptno;# 5. 列出所有“CLERK”(办事员)的姓名及其部门名称。SELECT ename, dept.dnameFROM emp, deptWHERE emp.job = 'CLERK' AND emp.deptno = dept.deptno;SELECT temp.ename, dept.dnameFROM dept, (SELECT ename, deptno FROM empWHERE job = 'CLERK') tempWHERE temp.deptno = dept.deptno;# 6. 列出最低薪金大于1500的各种工作。SELECT MIN(sal) AS min_sal, job FROM empGROUP BY job;# having filter out the record after settlementSELECT MIN(sal) AS min_sal, job FROM empGROUP BY jobHAVING min_sal &gt; 1500;# 7. 列出在部门“SALES”(销售部)工作的员工的姓名。# use selected table as second table can resume fewer resource# get the deptno of SALES firstSELECT DISTINCT deptno FROM deptWHERE dname = 'SALES';SELECT enameFROM emp, (SELECT DISTINCT deptno FROM deptWHERE dname = 'SALES') tempWHERE emp.deptno = temp.deptno;# 8. 列出薪金高于公司平均薪金的所有员工。SELECT AVG(sal) FROM emp; #2148.076923SELECT ename, salFROM emp, (SELECT AVG(sal) AS avg_salFROM emp) tempWHERE avg_sal &lt; sal;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="9"><li>列出与“SCOTT”从事相同工作的所有员工。</li><li>列出薪金高于在部门30工作的所有员工的薪金的员工姓名和薪金。</li><li>列出在每个部门工作的员工数量、平均工资和平均服务期限。</li><li>列出所有员工的姓名、部门名称和工资。</li><li>列出所有部门的详细信息和部门人数。</li><li>列出各种工作的最低工资。</li><li>列出MANAGER(经理)的最低薪金。</li><li>列出所有员工的年工资,按年薪从低到高排疗宝</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 9. 列出与“SCOTT”从事相同工作的所有员工。SELECT jobFROM empWHERE ename = 'SCOTT';SELECT emp.ename, emp.jobFROM emp, (SELECT jobFROM empWHERE ename = 'SCOTT') scott_jobWHERE emp.job = scott_job.jobAND emp.ename != 'SCOTT';# 10. 列出薪金高于在部门30工作的所有员工的薪金的员工姓名和薪金。# first waySELECT ename, emp.salFROM empWHERE emp.sal &gt; ALL(SELECT sal FROM empWHERE deptno = 30)# second way is betterSELECT ename, salFROM emp, (SELECT MAX(sal) AS max_salFROM empWHERE deptno = 30) tempWHERE emp.sal &gt; temp.max_sal;# 11. 列出在每个部门工作的员工数量、平均工资和平均服务期限。SELECT deptno, COUNT(*), ROUND(AVG(sal)), ROUND(AVG(DATEDIFF(NOW(),hiredate)))FROM empGROUP BY deptno;# 12. 列出所有员工的姓名、部门名称和工资。SELECT ename, dname, salFROM emp, deptWHERE emp.deptno = dept.deptno# 13. 列出所有部门的详细信息和部门人数。SELECT dept.deptno, dname, cnt, locFROM dept, (SELECT COUNT(*) AS cnt, deptnoFROM empGROUP BY deptno) dept_cntWHERE dept.deptno = dept_cnt.deptno ;# usage of table.*SELECT dept.*, locFROM dept, (SELECT COUNT(*) AS cnt, deptnoFROM empGROUP BY deptno) dept_cntWHERE dept.deptno = dept_cnt.deptno ;# 14. 列出各种工作的最低工资。SELECT min(sal), jobFROM empGROUP BY job;# 15. 列出MANAGER(经理)的最低薪金。SELECT min(sal)FROM empWHERE job = 'MANAGER';# 16. 列出所有员工的年工资,按年薪从低到高排序SELECT ename, 13*(sal + IFNULL(comm,0)) AS annual_salFROM empORDER BY annual_salSELECT ename, 13*(sal + IFNULL(comm,0)) annual_salFROM empORDER BY annual_sal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="tips"><a href="#tips" class="headerlink" title="tips:"></a>tips:</h3><ol><li>第二章表尽可能的简洁，因为在查找的时候是会形成一张大表的</li><li>两张表连接的时候考虑的是连接的那个条件，那个field是子表要有的</li><li>AS有的时候是可以去掉的</li></ol><h2 id="9-comprehensive-exercise"><a href="#9-comprehensive-exercise" class="headerlink" title="9. comprehensive exercise"></a>9. comprehensive exercise</h2><ol><li>设学校环境如下:<br>一个系有若干个专业<br>每个专业一年只招一个班<br>每个班有若干个学生。</li><li>现要建立关于系、学生、班级的数据库，关系模式为:<br>班CLASS (班号classid，专业名subject，系名deptname，入学年份enrolltime，人数num)<br>学生STUDENT(学号studentid，姓名name，年龄age，班号classid)<br>系DEPARTMENT(系号departmentid，系名deptname)</li><li>试用SQL语言完成以下功能<ol><li>建表，在定义中要求声明:<ol><li>每个表的主外码。</li><li>deptname是唯一约束。</li><li>学生姓名不能为空。</li></ol></li><li>插入如下数据</li></ol></li></ol><table><thead><tr><th>DEPARTMENT</th><th>CLASS</th><th>STUDENT</th></tr></thead><tbody><tr><td><img src="../../%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20220910112610443.png" alt="image-20220910112610443"></td><td><img src="../../%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20220910112616753.png" alt="image-20220910112616753"></td><td><img src="../../%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20220910112621408.png" alt="image-20220910112621408"></td></tr></tbody></table><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># create tableCREATE TABLE DEPARTMENT (departmentid VARCHAR(4) NOT NULL DEFAULT '' PRIMARY KEY,deptname VARCHAR(32) NOT NULL DEFAULT '' UNIQUE)CREATE TABLE CLASS (classid INT UNSIGNED PRIMARY KEY,`subject` VARCHAR(32) NOT NULL DEFAULT '',deptname VARCHAR(32) NOT NULL DEFAULT '',enrolltime INT UNSIGNED,num INT UNSIGNED,FOREIGN KEY(deptname) REFERENCES  DEPARTMENT(deptname) # foreign key)CREATE TABLE STUDENT (studentid INT UNSIGNED PRIMARY KEY, # primary`name` VARCHAR(32) NOT NULL DEFAULT '',age INT UNSIGNED,classid INT UNSIGNED,FOREIGN KEY(classid) REFERENCES CLASS(classid));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># insert recordINSERT INTO DEPARTMENT VALUES('001', '数学'),('002', '计算机'),('003', '化学'),('004', '中文'),('005', '经济')insert into class values(101,'软件','计算机',1995,20);insert into class values(102,'微电子','计算机',1996,30);insert into class values(111,'无机化学','化学',1995,29);insert into class values(112,'高分子化学','化学',1996,25);insert into class values(121,'统计数学','数学',1995,20);insert into class values(131,'现代语言','中文',1996,20);insert into class values(141,'国际贸易','经济',1997,30);insert into class values(142,'国际金融','经济',1996,14);insert into student values(8101,'张三',18,101);insert into student values(8102,'钱四',16,121);insert into student values(8103,'王玲',17,131);insert into student values(8105,'李飞',19,102);insert into student values(8109,'赵四',18,141);insert into student values(8110,'李可',20,142);insert into student values(8201,'张飞',18,111);insert into student values(8302,'周瑜',16,112);insert into student values(8203,'王亮',17,111);insert into student values(8305,'董庆',19,102);insert into student values(8409,'赵龙',18,101);insert into student values(8510,'李丽',20,142);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>完成以下查询功能<ol><li>找出所有姓李的学生。</li><li>列出所有开设超过1个专业的系的名字。</li><li>==列出人数大于等于30的系的编号和名字==。</li></ol></li><li>学校又新增加了一个物理系，编号为006</li><li>==学生张三退学，请更新相关的表==(transaction)</li></ol><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 找出所有姓李的学生。SELECT * FROM STUDENTWHERE `name` LIKE '李%'# 列出所有开设超过1个专业的系的名字。SELECT department.deptname, COUNT(*) AS numFROM DEPARTMENT, CLASSWHERE class.deptname = department.deptnameGROUP BY department.deptnameHAVING num &gt; 1;# table class contains deptnameSELECT COUNT(*) AS num, deptnameFROM classGROUP BY deptnameHAVING num &gt; 1;# 列出人数大于等于30的系的编号和名字。# first: get the name of each departmentSELECT COUNT(*), class.deptnameFROM class, studentWHERE class.classid = student.classidGROUP BY class.deptname;SELECT sum(num), deptnameFROM classGROUP BY deptname;# the id is not shownSELECT sum(num) num, deptnameFROM classGROUP BY deptnameHAVING num &gt; 30;SELECT departmentid, temp.deptname, temp.numFROM department, (SELECT sum(num) num, deptnameFROM classGROUP BY deptnameHAVING num &gt; 30) tempWHERE temp.deptname = department.deptname# 学生张三退学，请更新相关的表, use transactionstart TRANSACTION;UPDATE classSET num = num - 1WHERE classid = ( # = selected tableSELECT classidFROM studentWHERE `name` = '张三' ); # sperate single command with ;, don't forgetDELETE FROM student WHERE `name` = '张三';commit;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">学习b站韩顺平老师的mysql做的笔记，仅供个人使用</summary>
    
    
    
    <category term="笔记" scheme="http://crispycandy.top/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="笔记" scheme="http://crispycandy.top/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>追求完美？可能只是在逃避</title>
    <link href="http://crispycandy.top/zi-wo-zong-jie/zhui-qiu-wan-mei-ke-neng-zhi-shi-zai-tao-bi/"/>
    <id>http://crispycandy.top/zi-wo-zong-jie/zhui-qiu-wan-mei-ke-neng-zhi-shi-zai-tao-bi/</id>
    <published>2023-01-10T07:15:57.000Z</published>
    <updated>2023-01-10T08:02:16.432Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>追求完美是导致拖延的因素   ——我</p></blockquote><p>​    前段时间就看到过有视频有这样的观点，但是最近才深有体会。</p><p>​    其实我本人就有拖延的毛病，也尝试过很多办法来克服拖延，但事实上并没有起到什么效果。主要因为之前的方法都是强行克制自己的行为，比如说规定时间不玩手机，规定时间去学习，强迫自己不去拖延，这些方法并没有从根本上解决问题。(事实上我也很不喜欢这种强行逆想法的行为，要想改变还得从认知方面改变)</p><p>​    最近发现，导致我拖延很重要的一个因素就是追求所谓的完美，这可以从两方面来说：</p><p>​    第一点，不愿意结束当下的事情。有的时候是在学习一块知识，有的时候是在刷一个视频，有的时候是在看游戏直播；当有新的任务来临或者ddl快要到的时候，我总是希望自己能够将这块知识学完，等看完这一个小时视频或者等这把游戏看完之后再开始。但事实上，可能几个小时就浪费了，特别是有一大块知识的时候，可能要学习好几天。因此每次ddl来临之际，或者新作业布置下来，我总是在推托，等到当下的事情做完之后，再开始新的事情。</p><p>​    第二点，不愿意开始新的事情。即使ddl就剩下最后几天，我也不愿意开始。比如看视频，当遇到一些感觉挺有意义的视频，我总会认为当下不适合看这些视频，得找一个能静下心来的时候，大脑清晰的时候，想要学习的时候再看，于是我就会点击“稍后再看”，然后又去刷那些“没有意义”的视频，因此导致稍后再看一栏堆越堆越满，最终导致堆满了却一个视频都没看，然后删除不想看的视频。。。（现在看起来又很搞笑）。又或者是希望学习一项新的本领，比如说搭建博客，又或者是学习git，其实几个小时就很快能解决的事情，但是我也会认为当下不适合学习，要找一个完美的时机来学习，但事实上，当下并没有什么事情可以去做，只能又陷入到刷视频当中。又或者完成学校的大作业，总是希望自己能够找一个完美的时机，不会被打扰的实际去完成。</p><p>​    本质上，这两种情况都是在逃避，只想做自己当下的事情，不愿意面对不想做的事情。</p><p>​    但事情的结果就是，当下的事情并没有那么重要，不想做的事情一拖再拖。明明没什么事情干，但是就觉得今天不想做，就欺骗自己明天开始完整的去做，然后留给自己完成大作业的时间就剩下一两天了，然后逼得自己完成。</p><p>​    解决的办法，就是自己去明确这种所谓的追去完美，实际上是在欺骗自己。当遇到新的事情的时候，要知道它并没有那么可怕。</p><p>​    只要敢于开始，那么后面的过程就会很轻松。</p>]]></content>
    
    
    <summary type="html">追求所谓的“完美”，才不愿意放下当下，开始新事物，才会拖延。实际上这都是在逃避。</summary>
    
    
    
    <category term="自我总结" scheme="http://crispycandy.top/categories/%E8%87%AA%E6%88%91%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="三省吾身" scheme="http://crispycandy.top/tags/%E4%B8%89%E7%9C%81%E5%90%BE%E8%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>使用hexo搭建博客</title>
    <link href="http://crispycandy.top/uncategorized/shi-yong-hexoda-jian-bo-ke/"/>
    <id>http://crispycandy.top/uncategorized/shi-yong-hexoda-jian-bo-ke/</id>
    <published>2023-01-08T08:28:15.000Z</published>
    <updated>2023-01-08T10:54:07.351Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.bilibili.com/video/BV1Yb411a7ty/?spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=c749240dfe489e71ec336f64813c1bea">感谢CodeSheep的技术分享</a></p><h2 id="1-下载"><a href="#1-下载" class="headerlink" title="1. 下载"></a>1. 下载</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="(1) 环境准备"></a>(1) 环境准备</h3><p><a href="https://nodejs.org/en/">官网在这</a></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107154512525.png" alt="image-20230107154512525"></p><p>下载长期支持版的</p><p>然后一直安装即可</p><p>安装完有两个组件</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107154719439.png" alt="image-20230107154719439"></p><p>然后在命令行操作</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">node</span> <span class="token parameter variable">-v</span> <span class="token comment">#查看Node的版本</span><span class="token comment"># v18.13.9  直接输出了，不用配置</span><span class="token function">npm</span> <span class="token parameter variable">-v</span>  <span class="token comment">#包管理器</span><span class="token comment"># 8.19.3  包管理器的版本</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Hexo是需要Node.js生成的，因此需要先下载这个</p><h3 id="2-安装cnpm"><a href="#2-安装cnpm" class="headerlink" title="(2) 安装cnpm"></a>(2) 安装cnpm</h3><p>我们需要npm包管理器来安装，但是国内的镜像太慢，因此要利用npm来安装cnpm，就是淘宝的源(npm是Node.js自带的包管理器，但是我们需要的是淘宝的源)</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107155236840.png" alt="image-20230107155236840"></p><p>输入第一行指令，自动安装了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cnpm <span class="token comment">#输出信息就可以知道安装成功了</span>cnpm <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-安装hexo框架"><a href="#3-安装hexo框架" class="headerlink" title="(3) 安装hexo框架"></a>(3) 安装hexo框架</h3><p>用cnpm来安装hexo框架</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cnpm <span class="token function">install</span> <span class="token parameter variable">-g</span> hexo-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>-g是全局安装的意思</p></blockquote><p>然后自动安装好hexo框架了</p><pre class="line-numbers language-none"><code class="language-none">hexo -v # 验证安装<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-Hexo搭建博客"><a href="#2-Hexo搭建博客" class="headerlink" title="2. Hexo搭建博客"></a>2. Hexo搭建博客</h2><h3 id="1-初始化博客"><a href="#1-初始化博客" class="headerlink" title="(1) 初始化博客"></a>(1) 初始化博客</h3><p>先建立一个目录来存储博客文件，有什么问题将目录干掉重来即可</p><p>然后进入这个博客</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo init <span class="token comment"># 初始化这个博客</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>等待一段时间安装好</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107160209013.png" alt="image-20230107160209013"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107160224116.png" alt="image-20230107160224116"></p><p>这是博客基础的框架内容</p><h3 id="2-启动博客"><a href="#2-启动博客" class="headerlink" title="(2) 启动博客"></a>(2) 启动博客</h3><p>然后启动博客</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107160402826.png" alt="image-20230107160402826"></p><p>在4000这个端口开了一个博客</p><p>localhost:4000</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107160424866.png" alt="image-20230107160424866"></p><p>里面有hexo的内容</p><h3 id="3-新建一篇文章"><a href="#3-新建一篇文章" class="headerlink" title="(3) 新建一篇文章"></a>(3) 新建一篇文章</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo n <span class="token string">"我的第一篇文章"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>n是new的意思</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107160733566.png" alt="image-20230107160733566"></p><p>自动创建了md的文章</p><p>可以看到文章都是在_posts这个目录中</p><p>然后可以用编辑器编辑了</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span><span class="token front-matter yaml language-yaml">title: 我的第一篇文章date: 2023-01-07 16:07:25tags:</span><span class="token punctuation">---</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是自动生成的内容，不要改了，在下面写内容</p><h3 id="4-生成一篇文章"><a href="#4-生成一篇文章" class="headerlink" title="(4) 生成一篇文章"></a>(4) 生成一篇文章</h3><p>回到blog目录</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo cleanhexo g<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>g是generate的意思，这个是将md文件生成页面文件</p></blockquote><p>然后就生成这篇文章了</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107161312731.png" alt="image-20230107161312731"></p><p>生成了2023/01/07这个了</p><h3 id="5-重新启动查看"><a href="#5-重新启动查看" class="headerlink" title="(5) 重新启动查看"></a>(5) 重新启动查看</h3><pre class="line-numbers language-none"><code class="language-none">hexo s # 重新打开hexo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107161839129.png" alt="image-20230107161839129"></p><h2 id="3-部署博客"><a href="#3-部署博客" class="headerlink" title="3. 部署博客"></a>3. 部署博客</h2><p>博客肯定是要部署到远端的，没有服务器的话，可以免费部署到GitHub上</p><h3 id="1-新建仓库"><a href="#1-新建仓库" class="headerlink" title="(1) 新建仓库"></a>(1) 新建仓库</h3><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107162244991.png" alt="image-20230107162244991"></p><p>名字必须是 昵称.github.io</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107162329388.png" alt="image-20230107162329388"></p><h3 id="2-安装git插件"><a href="#2-安装git插件" class="headerlink" title="(2) 安装git插件"></a>(2) 安装git插件</h3><p>要部署到GitHub需要安装插件</p><p>到了blog目录下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cnpm <span class="token function">install</span> <span class="token parameter variable">--save</span> hexo-deployer-git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107162516659.png" alt="image-20230107162516659"></p><h3 id="3-配置"><a href="#3-配置" class="headerlink" title="(3) 配置"></a>(3) 配置</h3><p>就是设置_config.yml文件</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Deployment</span><span class="token comment">## Docs: https://hexo.io/docs/one-command-deployment</span><span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">'git'</span>  <span class="token key atrule">repo</span><span class="token punctuation">:</span> <span class="token string">'https://github.com/CrispyCandy750/CrispyCandy750.github.io.git'</span> <span class="token comment"># 生成文件的http地址复制过来，使用SSh地址好像部署的时候不用密码</span>  <span class="token key atrule">branch</span><span class="token punctuation">:</span> <span class="token string">'master'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-部署"><a href="#4-部署" class="headerlink" title="(4) 部署"></a>(4) 部署</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>d是deploy的意思</p></blockquote><p>然后就会部署了</p><p>之前使用的SSH地址就不需要输入密码</p><p>然后刷新GitHub的仓库</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107163233006.png" alt="image-20230107163233006"></p><h3 id="5-访问博客"><a href="#5-访问博客" class="headerlink" title="(5) 访问博客"></a>(5) 访问博客</h3><p>仓库名就是博客的地址 <code>CrispyCandy750.github.io</code></p><h2 id="4-自定义主题"><a href="#4-自定义主题" class="headerlink" title="4. 自定义主题"></a>4. 自定义主题</h2><h3 id="1-下载主题"><a href="#1-下载主题" class="headerlink" title="(1) 下载主题"></a>(1) 下载主题</h3><p>这里演示如何自定义主题</p><p><a href="https://github.com/litten/hexo-theme-yilia">https://github.com/litten/hexo-theme-yilia</a></p><p>在这个网站中设置的，下载主题</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/litten/hexo-theme-yilia themes/yilia<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将这个仓库下载到blog/themes/yilia下面</p><h3 id="2-配置主题"><a href="#2-配置主题" class="headerlink" title="(2) 配置主题"></a>(2) 配置主题</h3><p>还是修改_conig.yml文件</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Extensions</span><span class="token comment">## Plugins: https://hexo.io/plugins/</span><span class="token comment">## Themes: https://hexo.io/themes/</span><span class="token key atrule">theme</span><span class="token punctuation">:</span> yilia<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>将原来的主题换成yilia即可</p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107164310243.png" alt="image-20230107164310243"></p><p><img src="https://crispy-candy-image.oss-cn-beijing.aliyuncs.com/img/image-20230107164742266-16730812627801.png" alt="image-20230107164742266"></p><p>发现博客主题已经变了</p><p>然后重新部署</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>改了主题不是立马生效，多刷新一下</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.bilibili.com/video/BV1Yb411a7ty/?spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;amp;vd_source=c7492</summary>
      
    
    
    
    
    <category term="笔记" scheme="http://crispycandy.top/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="博客" scheme="http://crispycandy.top/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
</feed>
